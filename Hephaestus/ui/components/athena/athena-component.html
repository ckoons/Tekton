<!-- Athena Component - Knowledge Graph and Entity Management -->

<!-- Hidden radio inputs for CSS-first tab functionality -->
<input type="radio" name="athena-tab" id="athena-tab-graph" checked style="display: none;">
<input type="radio" name="athena-tab" id="athena-tab-entities" style="display: none;">
<input type="radio" name="athena-tab" id="athena-tab-query" style="display: none;">
<input type="radio" name="athena-tab" id="athena-tab-chat" style="display: none;">
<input type="radio" name="athena-tab" id="athena-tab-teamchat" style="display: none;">

<div class="athena" data-tekton-area="athena" data-tekton-component="athena" data-tekton-type="component-workspace" data-tekton-ai="athena-assistant" data-tekton-ai-ready="false">
    <!-- Component Header with Title -->
    <div class="athena__header" data-tekton-zone="header" data-tekton-section="header">
        <div class="athena__title-container">
            <img src="/images/hexagon.jpg" alt="Tekton" class="athena__icon">
            <h2 class="athena__title">
                <span class="athena__title-main">Athena</span>
                <span class="athena__title-sub">Knowledge Graph</span>
            </h2>
        </div>
    </div>
    
    <!-- Athena Menu Bar with Tab Navigation -->
    <div class="athena__menu-bar" data-tekton-zone="menu" data-tekton-zone="menu" data-tekton-nav="component-menu">
        <div class="athena__tabs" data-tekton-zone="menu">
            <label for="athena-tab-graph" class="athena__tab" data-tab="graph" data-tekton-menu-item="Knowledge Graph" data-tekton-menu-component="athena" data-tekton-menu-panel="graph-panel" data-tekton-nav-target="graph-panel">
                <span class="athena__tab-label">Knowledge Graph</span>
            </label>
            <label for="athena-tab-entities" class="athena__tab" data-tab="entities" data-tekton-menu-item="Entities" data-tekton-menu-component="athena" data-tekton-menu-panel="entities-panel" data-tekton-nav-target="entities-panel">
                <span class="athena__tab-label">Entities</span>
            </label>
            <label for="athena-tab-query" class="athena__tab" data-tab="query" data-tekton-menu-item="Query Builder" data-tekton-menu-component="athena" data-tekton-menu-panel="query-panel" data-tekton-nav-target="query-panel">
                <span class="athena__tab-label">Query Builder</span>
            </label>
            <label for="athena-tab-chat" class="athena__tab" data-tab="chat" data-tekton-menu-item="Knowledge Chat" data-tekton-menu-component="athena" data-tekton-menu-panel="chat-panel" data-tekton-nav-target="chat-panel">
                <span class="athena__tab-label">Knowledge Chat</span>
            </label>
            <label for="athena-tab-teamchat" class="athena__tab" data-tab="teamchat" data-tekton-menu-item="Team Chat" data-tekton-menu-component="athena" data-tekton-menu-panel="teamchat-panel" data-tekton-nav-target="teamchat-panel">
                <span class="athena__tab-label">Team Chat</span>
            </label>
        </div>
        <div class="athena__actions">
            <button id="clear-chat-btn" class="athena__action-button" style="display: none;" data-tekton-action="clear-chat" data-tekton-action-type="secondary">
                <span class="athena__button-label">Clear</span>
            </button>
        </div>
    </div>
    
    <!-- Athena Content Area -->
    <div class="athena__content" data-tekton-zone="content" data-tekton-scrollable="true">
        <!-- Graph Tab (Default Active Tab) -->
        <div id="graph-panel" class="athena__panel" data-tekton-panel="graph" data-tekton-panel-for="Knowledge Graph" data-tekton-panel-component="athena">
            <div class="athena__graph">
                <div class="athena__control-bar">
                    <div class="athena__search-container">
                        <input type="text" id="graph-search" class="athena__search-input" placeholder="Search entities...">
                        <button id="graph-search-btn" class="athena__search-button" data-tekton-action="search-graph" data-tekton-action-type="primary">Search</button>
                    </div>
                    <div class="athena__filter-container">
                        <select id="entity-type-filter" class="athena__filter-select">
                            <option value="all">All Types</option>
                            <option value="person">Person</option>
                            <option value="project">Project</option>
                            <option value="document">Document</option>
                            <option value="concept">Concept</option>
                            <option value="organization">Organization</option>
                        </select>
                        <button id="apply-filter-btn" class="athena__filter-button" data-tekton-action="apply-filter" data-tekton-action-type="primary">Apply</button>
                    </div>
                </div>
                <div id="graph-container" class="athena__graph-container">
                    <div id="graph-placeholder" class="athena__graph-placeholder">
                        <div class="athena__placeholder-content">
                            <h3 class="athena__placeholder-title">Knowledge Graph Visualization</h3>
                            <p class="athena__placeholder-text">The graph will be displayed here once loaded.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Entities Tab -->
        <div id="entities-panel" class="athena__panel" data-tekton-panel="entities" data-tekton-panel-for="Entities" data-tekton-panel-component="athena" data-tekton-panel-active="false">
            <div class="athena__entities">
                <div class="athena__control-bar">
                    <div class="athena__search-container">
                        <input type="text" id="entity-search" class="athena__search-input" placeholder="Search entities...">
                        <button id="entity-search-btn" class="athena__search-button" data-tekton-action="search-entities" data-tekton-action-type="primary">Search</button>
                    </div>
                    <div class="athena__actions">
                        <button id="add-entity-btn" class="athena__action-button" data-tekton-action="add-entity" data-tekton-action-type="primary">
                            <span class="athena__button-icon">+</span>
                            <span class="athena__button-label">Add Entity</span>
                        </button>
                    </div>
                </div>
                <div class="athena__entity-list-container">
                    <div id="entity-list-loading" class="athena__loading-indicator">
                        <div class="athena__spinner"></div>
                        <div class="athena__loading-text">Loading entities...</div>
                    </div>
                    <div id="entity-list-items" class="athena__entity-list" style="display: none;">
                        <!-- Sample entities for UI testing -->
                        <div class="athena__entity-item">
                            <div class="athena__entity-type-icon athena__entity-type-icon--person">👤</div>
                            <div class="athena__entity-details">
                                <div class="athena__entity-name">Casey Koons</div>
                                <div class="athena__entity-type">Person</div>
                                <div class="athena__entity-properties">Project Lead, Engineering</div>
                            </div>
                            <div class="athena__entity-actions">
                                <button class="athena__entity-action-btn" data-tekton-action="view-entity" data-tekton-action-type="secondary">View</button>
                                <button class="athena__entity-action-btn" data-tekton-action="edit-entity" data-tekton-action-type="secondary">Edit</button>
                            </div>
                        </div>
                        <div class="athena__entity-item">
                            <div class="athena__entity-type-icon athena__entity-type-icon--project">📂</div>
                            <div class="athena__entity-details">
                                <div class="athena__entity-name">Tekton</div>
                                <div class="athena__entity-type">Project</div>
                                <div class="athena__entity-properties">AI Orchestration System</div>
                            </div>
                            <div class="athena__entity-actions">
                                <button class="athena__entity-action-btn" data-tekton-action="view-entity" data-tekton-action-type="secondary">View</button>
                                <button class="athena__entity-action-btn" data-tekton-action="edit-entity" data-tekton-action-type="secondary">Edit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Query Builder Tab -->
        <div id="query-panel" class="athena__panel" data-tekton-panel="query" data-tekton-panel-for="Query Builder" data-tekton-panel-component="athena" data-tekton-panel-active="false">
            <div class="athena__query-builder">
                <h3 class="athena__section-title">Query Builder</h3>
                <p class="athena__text">Construct queries to find entities and relationships in the knowledge graph.</p>

                <div class="athena__query-form">
                    <div class="athena__form-group">
                        <label class="athena__form-label">Entity Type</label>
                        <select class="athena__form-select" id="entity-type-select">
                            <option value="any">Any Type</option>
                            <option value="person">Person</option>
                            <option value="project">Project</option>
                            <option value="organization">Organization</option>
                            <option value="document">Document</option>
                            <option value="concept">Concept</option>
                        </select>
                    </div>

                    <div class="athena__form-group">
                        <label class="athena__form-label">Relationship Type</label>
                        <select class="athena__form-select" id="relationship-type-select">
                            <option value="any">Any Relationship</option>
                            <option value="works_on">Works On</option>
                            <option value="manages">Manages</option>
                            <option value="member_of">Member Of</option>
                            <option value="created">Created</option>
                            <option value="related_to">Related To</option>
                        </select>
                    </div>

                    <div class="athena__form-group">
                        <label class="athena__form-label">Search Terms</label>
                        <input type="text" class="athena__form-input" id="search-terms-input" placeholder="Enter search terms...">
                    </div>

                    <div class="athena__form-group">
                        <label class="athena__form-label">Additional Filters</label>
                        <div class="athena__checkbox-group">
                            <label class="athena__checkbox-label">
                                <input type="checkbox" class="athena__checkbox" id="include-archived"> Include archived entities
                            </label>
                            <label class="athena__checkbox-label">
                                <input type="checkbox" class="athena__checkbox" id="exact-match"> Exact match only
                            </label>
                        </div>
                    </div>

                    <div class="athena__form-actions">
                        <button class="athena__button athena__button--secondary" id="clear-query-btn" data-tekton-action="clear-query" data-tekton-action-type="secondary">Clear</button>
                        <button class="athena__button athena__button--primary" id="build-query-btn" data-tekton-action="build-query" data-tekton-action-type="primary">Build Query</button>
                    </div>
                </div>

                <div class="athena__query-result" style="margin-top: 20px; display: none;" id="query-result-container">
                    <h4 class="athena__result-title">Generated Query</h4>
                    <div class="athena__code-block" id="generated-query" style="background: #333; padding: 15px; border-radius: 6px; font-family: monospace; white-space: pre-wrap;">
                        <!-- Generated query will appear here -->
                    </div>

                    <div class="athena__form-actions" style="margin-top: 15px;">
                        <button class="athena__button athena__button--secondary" id="copy-query-btn" data-tekton-action="copy-query" data-tekton-action-type="secondary">Copy Query</button>
                        <button class="athena__button athena__button--primary" id="execute-query-btn" data-tekton-action="execute-query" data-tekton-action-type="primary">Execute Query</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chat Tab -->
        <div id="chat-panel" class="athena__panel" data-tekton-panel="chat" data-tekton-panel-for="Knowledge Chat" data-tekton-panel-component="athena" data-tekton-panel-active="false">
            <div id="chat-messages" class="athena__chat-messages">
                <!-- Welcome message -->
                <div class="athena__message athena__message--system">
                    <div class="athena__message-content">
                        <div class="athena__message-text">
                            <h3 class="athena__message-title">Welcome to Athena Knowledge Chat</h3>
                            <p>You can ask questions about any entities in the knowledge graph. Try questions like:</p>
                            <ul>
                                <li>What do you know about [entity name]?</li>
                                <li>How are [entity1] and [entity2] related?</li>
                                <li>What projects is [person/team] working on?</li>
                                <li>Summarize what we know about [topic]</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Team Chat Tab -->
        <div id="teamchat-panel" class="athena__panel" data-tekton-panel="teamchat" data-tekton-panel-for="Team Chat" data-tekton-panel-component="athena" data-tekton-panel-active="false">
            <div id="teamchat-messages" class="athena__chat-messages">
                <!-- Welcome message -->
                <div class="athena__message athena__message--system">
                    <div class="athena__message-content">
                        <div class="athena__message-text">
                            <h3 class="athena__message-title">Tekton Team Chat</h3>
                            <p>This chat is shared across all Tekton components. Use this for team communication and coordination.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer with Chat Input - Always visible at bottom -->
    <div class="athena__footer" data-tekton-zone="footer" data-tekton-section="footer">
        <div class="athena__chat-input-container" 
             data-tekton-chat="athena-knowledge" 
             data-tekton-chat-component="athena"
             data-tekton-element="chat-input-container">
            <div class="athena__chat-prompt" data-tekton-element="chat-prompt">></div>
            <input type="text" class="athena__chat-input" id="athena-chat-input"
                   data-tekton-input="chat-input"
                   data-tekton-input-type="chat"
                   data-tekton-input-component="athena"
                   placeholder="Enter chat message for Athena knowledge graph queries, entities or information"
                   style="background-color: #1a1a2e !important;"
                   onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); athena_sendChat(); }">
            <button class="athena__send-button" id="athena-send-button" onclick="athena_sendChat(); return false;"
                    data-tekton-action="send-message"
                    data-tekton-action-type="primary"
                    data-tekton-action-component="athena">Send</button>
        </div>
    </div>
</div>

<!-- Add component-specific styles -->
<style>
    /* Athena component styles using BEM naming convention */
    
    /* Container - Full height with footer always visible */
    .athena {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        background-color: var(--bg-primary, #1e1e2e);
        color: var(--text-primary, #f0f0f0);
        position: relative; /* Needed for absolute positioned footer */
        min-height: 100%;
    }
    
    /* Header */
    .athena__header {
        display: flex;
        align-items: center;
        padding: 10px 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Standardized header height */
    }
    
    .athena__title-container {
        display: flex;
        align-items: center;
    }
    
    .athena__icon {
        height: 30px;
        width: auto;
        margin-right: 12px;
    }
    
    .athena__title {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 500;
    }
    
    .athena__title-sub {
        margin-left: 8px;
        opacity: 0.8;
        font-weight: normal;
    }
    
    /* Menu Bar */
    .athena__menu-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Standardized menu bar height */
    }
    
    .athena__tabs {
        display: flex;
        gap: 8px;
    }
    
    .athena__tab {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background-color: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .athena__tab:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }
    
    .athena__tab--active {
        border-bottom-color: var(--color-primary, #7B1FA2);
        font-weight: 500;
    }
    
    /* CSS-first tab switching */
    #athena-tab-graph:checked ~ .athena .athena__tab[for="athena-tab-graph"],
    #athena-tab-entities:checked ~ .athena .athena__tab[for="athena-tab-entities"],
    #athena-tab-query:checked ~ .athena .athena__tab[for="athena-tab-query"],
    #athena-tab-chat:checked ~ .athena .athena__tab[for="athena-tab-chat"],
    #athena-tab-teamchat:checked ~ .athena .athena__tab[for="athena-tab-teamchat"] {
        border-bottom-color: var(--color-primary, #7B1FA2);
        font-weight: 500;
    }
    
    /* Panel visibility based on radio buttons */
    #athena-tab-graph:checked ~ .athena #graph-panel,
    #athena-tab-entities:checked ~ .athena #entities-panel,
    #athena-tab-query:checked ~ .athena #query-panel,
    #athena-tab-chat:checked ~ .athena #chat-panel,
    #athena-tab-teamchat:checked ~ .athena #teamchat-panel {
        display: block;
    }
    
    /* Clear button visibility for chat tabs */
    #athena-tab-chat:checked ~ .athena #clear-chat-btn,
    #athena-tab-teamchat:checked ~ .athena #clear-chat-btn {
        display: block !important;
    }
    
    .athena__actions {
        display: flex;
        gap: 8px;
    }
    
    .athena__action-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .athena__action-button:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }
    
    /* Content Area - Scrollable between menu and footer */
    .athena__content {
        flex: 1;
        overflow: hidden;
        position: relative;
        margin-bottom: 70px; /* Account for footer height */
    }
    
    .athena__panel {
        display: none;
        height: 100%;
        width: 100%;
        overflow-y: auto; /* Scroll content when needed */
        overflow-x: hidden;
    }
    
    
    /* Control Bar */
    .athena__control-bar {
        display: flex;
        justify-content: space-between;
        padding: 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Standard control bar height */
    }
    
    .athena__search-container {
        display: flex;
        gap: 8px;
    }
    
    .athena__search-input {
        padding: 8px 12px;
        min-width: 260px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
    }
    
    .athena__filter-container {
        display: flex;
        gap: 8px;
    }
    
    .athena__filter-select {
        padding: 8px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
    }
    
    .athena__filter-button,
    .athena__search-button {
        padding: 8px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
    }
    
    /* Graph Container */
    .athena__graph-container {
        height: calc(100% - 68px);
        overflow: hidden;
        position: relative;
    }
    
    .athena__graph-placeholder {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        padding: 20px;
        text-align: center;
    }
    
    /* Entity List */
    .athena__entity-list-container {
        padding: 16px;
    }
    
    .athena__entity-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .athena__entity-item {
        display: flex;
        align-items: center;
        padding: 12px;
        background-color: var(--bg-secondary, #252535);
        border: 1px solid var(--border-color, #444444);
        border-radius: 8px;
        transition: all 0.2s ease;
    }
    
    .athena__entity-item:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }
    
    .athena__entity-type-icon {
        font-size: 24px;
        margin-right: 16px;
        padding: 8px;
        border-radius: 8px;
        background-color: var(--bg-tertiary, #333345);
    }
    
    .athena__entity-details {
        flex: 1;
    }
    
    .athena__entity-name {
        font-weight: 500;
        margin-bottom: 4px;
    }
    
    .athena__entity-type {
        color: var(--text-secondary, #aaaaaa);
        margin-bottom: 4px;
        font-size: 0.9em;
    }
    
    .athena__entity-properties {
        color: var(--text-secondary, #aaaaaa);
        font-size: 0.9em;
    }
    
    .athena__entity-actions {
        display: flex;
        gap: 8px;
    }
    
    .athena__entity-action-btn {
        padding: 6px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        font-size: 0.85em;
        transition: all 0.2s ease;
    }
    
    .athena__entity-action-btn:hover {
        background-color: var(--bg-hover, #3a3a4a);
        transform: translateY(-1px);
    }
    
    /* Primary action button (View) */
    .athena__entity-action-btn[data-action="view"] {
        background-color: #7B1FA2;
        border-color: #7B1FA2;
        color: white;
    }
    
    .athena__entity-action-btn[data-action="view"]:hover {
        background-color: #6A1B9A;
        border-color: #6A1B9A;
    }
    
    /* Secondary action button (Edit) */
    .athena__entity-action-btn[data-action="edit"] {
        background-color: #1976D2;
        border-color: #1976D2;
        color: white;
    }
    
    .athena__entity-action-btn[data-action="edit"]:hover {
        background-color: #1565C0;
        border-color: #1565C0;
    }
    
    /* Chat Panel */
    #chat-panel, #teamchat-panel {
        position: relative; /* Needed for footer positioning */
        overflow: hidden; /* Prevent double scrollbars */
        height: 100%; /* Ensure full height */
    }

    /* Chat Messages */
    .athena__chat-messages {
        height: calc(100% - 70px); /* Full height minus footer */
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    /* Messages - Following Apollo's improved styling pattern */
    .athena__message {
        margin-bottom: 16px;
        display: flex;
        align-items: flex-start;
    }
    
    .athena__message--user {
        justify-content: flex-end;
    }
    
    .athena__message--ai {
        justify-content: flex-start;
    }
    
    .athena__message--system {
        justify-content: center;
    }
    
    .athena__message-content {
        max-width: 70%;
        padding: 12px 16px;
        border-radius: 8px;
        background-color: var(--bg-secondary, #252535);
        color: var(--text-primary, #f0f0f0);
    }
    
    /* System messages */
    .athena__message--system .athena__message-content {
        background-color: transparent;
        color: var(--text-secondary, #a0a0a0);
        font-style: italic;
        text-align: center;
    }
    
    /* User messages */
    .athena__message--user .athena__message-content {
        background-color: rgba(123, 31, 162, 0.1);
        border: 1px solid #7B1FA2;
        color: var(--text-primary, #f0f0f0);
    }
    
    /* AI messages - Athena's purple theme */
    .athena__message--ai .athena__message-content {
        background-color: rgba(123, 31, 162, 0.05);
        border-left: 3px solid #7B1FA2;
    }
    
    .athena__message-content strong {
        display: inline-block;
        margin-right: 8px;
        font-weight: 600;
        color: #7B1FA2;
    }
    
    /* Message content styling */
    .athena__message-text ul {
        list-style: none;
        padding-left: 0;
        margin: 10px 0 0 0;
    }
    
    .athena__message-text ul li {
        padding: 4px 0;
        padding-left: 20px;
        position: relative;
    }
    
    .athena__message-text ul li:before {
        content: "•";
        color: #7B1FA2;
        font-weight: bold;
        position: absolute;
        left: 0;
    }
    
    /* Chat Input - ALWAYS VISIBLE AT BOTTOM */
    .athena__footer {
        background-color: var(--bg-secondary, #252535);
        border-top: 1px solid var(--border-color, #444444);
        padding: 12px 16px;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 70px; /* Fixed height to match chat area */
        z-index: 10; /* Ensure it's above content */
        display: block !important; /* ALWAYS VISIBLE */
    }
    
    .athena__chat-input-container {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%;
    }
    
    .athena__chat-prompt {
        font-size: 18px;
        font-weight: bold;
        color: #7B1FA2; /* Athena purple */
    }
    
    .athena__chat-input {
        flex: 1;
        height: 44px;
        padding: 8px 16px;
        background-color: #1a1a2e !important;
        border: 1px solid #444444;
        border-radius: 4px;
        color: #f0f0f0;
        font-size: 14px;
        outline: none;
    }
    
    .athena__chat-input::placeholder {
        color: #666666;
        opacity: 1;
    }
    
    .athena__chat-input:focus {
        border-color: #7B1FA2;
        box-shadow: 0 0 0 1px rgba(123, 31, 162, 0.2);
    }
    
    .athena__send-button {
        height: 44px;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #7B1FA2; /* Athena purple */
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .athena__send-button:hover {
        background-color: #6A1B9A; /* Darker purple on hover */
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(123, 31, 162, 0.3);
    }
    
    .athena__send-button:active {
        transform: translateY(0);
        box-shadow: none;
    }
    
    /* Loading Indicator */
    .athena__loading-indicator {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 200px;
    }

    .athena__spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top: 4px solid var(--color-primary, #7B1FA2);
        animation: athena-spin 1s linear infinite;
        margin-bottom: 16px;
    }

    /* Query Builder Form Styles */
    .athena__query-builder {
        padding: 20px;
    }

    .athena__section-title {
        margin-bottom: 16px;
        font-size: 24px;
        color: var(--text-primary, #f0f0f0);
    }

    .athena__text {
        margin-bottom: 24px;
        color: var(--text-secondary, #aaaaaa);
    }

    .athena__query-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 24px;
    }

    .athena__form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .athena__form-label {
        font-weight: 500;
        color: var(--text-primary, #f0f0f0);
    }

    .athena__form-select,
    .athena__form-input {
        padding: 10px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 6px;
        color: var(--text-primary, #f0f0f0);
        font-size: 14px;
    }

    .athena__checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .athena__checkbox-label {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-primary, #f0f0f0);
    }

    .athena__form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 8px;
    }

    .athena__button {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .athena__button--primary {
        background-color: var(--color-primary, #7B1FA2);
        color: white;
    }

    .athena__button--primary:hover {
        background-color: var(--color-primary-hover, #6A1B9A);
    }

    .athena__button--secondary {
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        color: var(--text-primary, #f0f0f0);
    }

    .athena__button--secondary:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }

    .athena__result-title {
        margin-bottom: 12px;
        font-size: 18px;
        color: var(--text-primary, #f0f0f0);
    }

    @keyframes athena-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Empty and error states */
    .athena__empty-state,
    .athena__error-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-secondary, #a0a0a0);
        font-size: 0.9rem;
    }
    
    .athena__error-state {
        color: #ff6b6b;
    }
    
    /* Danger button style */
    .athena__entity-action-btn--danger {
        color: #ff6b6b;
        border-color: #ff6b6b;
    }
    
    .athena__entity-action-btn--danger:hover {
        background-color: #ff6b6b;
        color: white;
    }
</style>

<!-- Include Tekton URL utilities and Athena Service -->
<script src="/scripts/tekton-urls.js"></script>
<script src="/scripts/athena-service.js"></script>
<!-- TEMPORARY: Mock service until backend routing is fixed -->
<script src="/scripts/athena-service-mock.js"></script>

<script type="text/javascript">
// SIMPLIFIED COMPONENT SCRIPT - FULLY SELF-CONTAINED
// This version minimizes interference with other components

// IMMEDIATELY SET UP UI MANAGER PROTECTION
// Tell UI Manager to ignore this component - must be done IMMEDIATELY to avoid races
if (window.uiManager) {
    window.uiManager._ignoreComponent = 'athena';
    console.log('[ATHENA] Set UI Manager to ignore athena component');
}

// CSS-first navigation - no JavaScript tab switching needed
// The radio buttons and CSS handle all tab switching automatically

// CHAT CLEARING FUNCTION
window.athena_clearChat = function() {
    console.log('[ATHENA] Clear chat clicked');
    
    try {
        // Get active tab ID within athena container
        const athenaContainer = document.querySelector('.athena');
        if (!athenaContainer) {
            console.error('[ATHENA] Clear Chat: Cannot find athena container');
            return false;
        }
        
        const activeTab = athenaContainer.querySelector('.athena__tab--active');
        const tabId = activeTab ? activeTab.getAttribute('data-tab') : '';
        
        if (tabId === 'chat' || tabId === 'teamchat') {
            // Get message container within athena container only
            const panel = athenaContainer.querySelector('#' + tabId + '-messages');
            if (panel) {
                // Keep welcome message
                const welcomeMsg = panel.querySelector('.athena__message--system');
                if (welcomeMsg) {
                    panel.innerHTML = '';
                    panel.appendChild(welcomeMsg);
                    console.log('[ATHENA] Cleared chat, kept welcome message');
                } else {
                    panel.innerHTML = '';
                    console.log('[ATHENA] Cleared chat completely');
                }
            }
        }
    } catch (err) {
        console.error('[ATHENA] Error clearing chat:', err);
    }
    
    return false; // Stop event propagation
};

// LOAD COMPONENT
// Load after defining tab switching to ensure it's available
function athena_loadComponent() {
    console.log('[ATHENA] Loading component script...');
    
    const timestamp = new Date().getTime();
    const scriptPath = `/scripts/athena/athena-component.js?t=${timestamp}`;
    
    const script = document.createElement('script');
    script.src = scriptPath;
    script.async = false;
    script.onload = function() {
        console.log('[ATHENA] Component script loaded successfully');
        
        if (window.athenaComponent && typeof window.athenaComponent.init === 'function') {
            try {
                window.athenaComponent.init();
                console.log('[ATHENA] Component initialized');
            } catch (err) {
                console.error('[ATHENA] Component initialization error:', err);
            }
        } else {
            console.warn('[ATHENA] Component init function not found');
        }
    };
    script.onerror = function() {
        console.error('[ATHENA] Failed to load component script');
    };
    
    document.body.appendChild(script);
}

// HTML PANEL PROTECTION
// Setup explicit protection for the HTML panel to prevent it being hidden
function athena_protectHtmlPanel() {
    const htmlPanel = document.getElementById('html-panel');
    if (!htmlPanel) {
        console.error('[ATHENA] Cannot find HTML panel to protect');
        return;
    }
    
    console.log('[ATHENA] Protecting HTML panel from being hidden');
    htmlPanel.style.display = 'block'; // Force it to be visible
    
    // Store the original display value
    if (!htmlPanel.hasOwnProperty('_athenaOriginalDisplay')) {
        Object.defineProperty(htmlPanel, '_athenaOriginalDisplay', {
            value: 'block',
            writable: true,
            configurable: true
        });
    }
    
    // Only define the getter/setter if it hasn't already been defined by this component
    if (!htmlPanel.style._athenaProtected) {
        // Mark the display property as protected by this component
        Object.defineProperty(htmlPanel.style, '_athenaProtected', {
            value: true,
            writable: false,
            configurable: true
        });
        
        // Protect the display property
        Object.defineProperty(htmlPanel.style, 'display', {
            get: function() { 
                return htmlPanel._athenaOriginalDisplay; 
            },
            set: function(value) {
                console.log(`[ATHENA] Intercepted attempt to set HTML panel display to: ${value}`);
                if (value === 'none') {
                    console.log('[ATHENA] Blocked attempt to hide HTML panel');
                    htmlPanel._athenaOriginalDisplay = 'block';
                } else {
                    htmlPanel._athenaOriginalDisplay = value;
                }
            },
            configurable: true
        });
    }
}

// SETUP DONE AFTER PAGE LOAD
// This ensures the functions are available before the tab events need them
window.addEventListener('DOMContentLoaded', function() {
    console.log('[ATHENA] DOM loaded, setting up Athena component');
    athena_protectHtmlPanel();
    athena_loadComponent();
});

// IMMEDIATE PROTECTION
// In case the DOM is already loaded
if (document.readyState === 'complete' || document.readyState === 'interactive') {
    console.log('[ATHENA] Document already loaded, setting up Athena component immediately');
    athena_protectHtmlPanel();
    athena_loadComponent();
}

// Chat functionality - Using immediate execution pattern
(function() {
    'use strict';
    console.log('[ATHENA] Setting up chat functionality');
    
    // Make chat function globally available
    window.athena_sendChat = function() {
        console.log('[ATHENA] Send chat triggered');
        const input = document.getElementById('athena-chat-input');
        const message = input.value.trim();
        
        if (!message) {
            console.log('[ATHENA] Empty message, ignoring');
            return;
        }
        
        // Determine which tab is active - check the radio inputs
        const knowledgeChatRadio = document.getElementById('athena-tab-chat');
        const teamChatRadio = document.getElementById('athena-tab-teamchat');
        const knowledgeChatActive = knowledgeChatRadio && knowledgeChatRadio.checked;
        const teamChatActive = teamChatRadio && teamChatRadio.checked;
        
        // Only proceed if we're on a chat tab
        if (!knowledgeChatActive && !teamChatActive) {
            console.log('[ATHENA] Not on a chat tab, ignoring');
            return;
        }
        
        const chatType = knowledgeChatActive ? 'chat' : 'teamchat';
        const messagesContainer = document.getElementById(`${chatType}-messages`);
        
        console.log('[ATHENA] Chat type:', chatType, 'Active:', knowledgeChatActive);
        
        // Add user message
        const userMessageDiv = document.createElement('div');
        userMessageDiv.className = 'athena__message athena__message--user';
        userMessageDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text">${message}</div></div>`;
        messagesContainer.appendChild(userMessageDiv);
        
        // Clear input
        input.value = '';
        
        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        // Send to backend
        if (chatType === 'chat') {
            // Direct message to athena
            if (window.AIChat) {
                console.log('[ATHENA] Sending message to Athena AI');
                window.AIChat.sendMessage('athena', message)
                    .then(response => {
                        console.log('[ATHENA] Received response:', response);
                        const aiMessageDiv = document.createElement('div');
                        aiMessageDiv.className = 'athena__message athena__message--ai';
                        aiMessageDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text"><strong>Athena:</strong> ${response.content}</div></div>`;
                        messagesContainer.appendChild(aiMessageDiv);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    })
                    .catch(err => {
                        console.error('[ATHENA] Failed to send message:', err);
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'athena__message athena__message--system';
                        errorDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text"><strong>System:</strong> Failed to connect to Athena AI</div></div>`;
                        messagesContainer.appendChild(errorDiv);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    });
            } else {
                console.warn('[ATHENA] AIChat not available');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'athena__message athena__message--system';
                errorDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text"><strong>System:</strong> AI Chat service not available</div></div>`;
                messagesContainer.appendChild(errorDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        } else {
            // Team chat
            if (window.AIChat) {
                console.log('[ATHENA] Sending team chat message');
                window.AIChat.teamChat(message, 'athena')
                    .then(data => {
                        console.log('[ATHENA] Team chat response:', data);
                        // Display team responses
                        if (data && data.responses && data.responses.length > 0) {
                            data.responses.forEach(resp => {
                                const aiMessageDiv = document.createElement('div');
                                aiMessageDiv.className = 'athena__message athena__message--ai';
                                const sender = resp.socket_id ? 
                                    resp.socket_id.replace('-ai', '').charAt(0).toUpperCase() + 
                                    resp.socket_id.replace('-ai', '').slice(1) : 'AI';
                                aiMessageDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text"><strong>${sender}:</strong> ${resp.content || resp.message || 'No response'}</div></div>`;
                                messagesContainer.appendChild(aiMessageDiv);
                            });
                            messagesContainer.scrollTop = messagesContainer.scrollHeight;
                        } else if (data) {
                            // Fallback for different response format
                            console.log('[ATHENA] Alternative response format:', data);
                            const aiMessageDiv = document.createElement('div');
                            aiMessageDiv.className = 'athena__message athena__message--system';
                            aiMessageDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text"><strong>System:</strong> Team chat response received but format unexpected</div></div>`;
                            messagesContainer.appendChild(aiMessageDiv);
                            messagesContainer.scrollTop = messagesContainer.scrollHeight;
                        }
                    })
                    .catch(err => {
                        console.error('[ATHENA] Failed to send team message:', err);
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'athena__message athena__message--system';
                        errorDiv.innerHTML = `<div class="athena__message-content"><div class="athena__message-text"><strong>System:</strong> Failed to send team message</div></div>`;
                        messagesContainer.appendChild(errorDiv);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    });
            }
        }
    };
    
    // Set up event handlers immediately
    const chatInput = document.getElementById('athena-chat-input');
    const sendButton = document.getElementById('athena-send-button');
    
    if (chatInput) {
        // Remove any existing inline handlers
        chatInput.onkeydown = null;
        
        // Add event listener
        chatInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                window.athena_sendChat();
            }
        });
        console.log('[ATHENA] Chat input event handler attached');
    }
    
    if (sendButton) {
        // Remove any existing inline handlers
        sendButton.onclick = null;
        
        // Add event listener
        sendButton.addEventListener('click', function(event) {
            event.preventDefault();
            window.athena_sendChat();
        });
        console.log('[ATHENA] Send button event handler attached');
    }
})();

// Clear chat functionality - Also set up immediately
(function() {
    'use strict';
    
    window.athena_clearChat = function() {
        console.log('[ATHENA] Clear chat triggered');
        const knowledgeChatRadio = document.getElementById('athena-tab-chat');
        const teamchatRadio = document.getElementById('athena-tab-teamchat');
        
        const knowledgeChatActive = knowledgeChatRadio && knowledgeChatRadio.checked;
        const teamchatActive = teamchatRadio && teamchatRadio.checked;
        
        if (knowledgeChatActive) {
            const messagesContainer = document.getElementById('chat-messages');
            if (messagesContainer) {
                // Keep the welcome message, remove all others
                const messages = messagesContainer.querySelectorAll('.athena__message:not(.athena__message--system)');
                messages.forEach(msg => msg.remove());
                console.log('[ATHENA] Cleared knowledge chat messages');
            }
        } else if (teamchatActive) {
            const messagesContainer = document.getElementById('teamchat-messages');
            if (messagesContainer) {
                // Keep the welcome message, remove all others
                const messages = messagesContainer.querySelectorAll('.athena__message:not(.athena__message--system)');
                messages.forEach(msg => msg.remove());
                console.log('[ATHENA] Cleared team chat messages');
            }
        }
    };
    
    // Set up clear button handler
    const clearButton = document.getElementById('clear-chat-btn');
    if (clearButton) {
        clearButton.addEventListener('click', function(event) {
            event.preventDefault();
            window.athena_clearChat();
        });
        console.log('[ATHENA] Clear button event handler attached');
    }
})();

// Entity management functions
(function() {
    'use strict';
    console.log('[ATHENA] Setting up entity management');
    
    // Load entities when entities tab is shown
    function loadEntities() {
        console.log('[ATHENA] Loading entities from API');
        
        const loadingIndicator = document.getElementById('entity-list-loading');
        const entityList = document.getElementById('entity-list-items');
        
        // Show loading
        if (loadingIndicator) loadingIndicator.style.display = 'flex';
        if (entityList) entityList.style.display = 'none';
        
        // Fetch entities from API
        if (window.AthenaService) {
            window.AthenaService.getEntities()
                .then(result => {
                    console.log('[ATHENA] Entities loaded:', result);
                    
                    // Hide loading
                    if (loadingIndicator) loadingIndicator.style.display = 'none';
                    if (entityList) {
                        entityList.style.display = 'block';
                        entityList.innerHTML = '';
                    }
                    
                    // The API returns an array directly, not wrapped in status/data
                    const entities = Array.isArray(result) ? result : 
                                   (result.data && Array.isArray(result.data)) ? result.data : 
                                   (result.status === 'success' && result.data) ? result.data : [];
                    
                    if (entities.length === 0) {
                        entityList.innerHTML = '<div class="athena__empty-state">No entities found. Click "Add Entity" to create your first entity.</div>';
                    } else {
                        entities.forEach(entity => {
                            const entityItem = createEntityElement(entity);
                            entityList.appendChild(entityItem);
                        });
                    }
                })
                .catch(error => {
                    console.error('[ATHENA] Error loading entities:', error);
                    if (loadingIndicator) loadingIndicator.style.display = 'none';
                    if (entityList) {
                        entityList.style.display = 'block';
                        entityList.innerHTML = '<div class="athena__error-state">Error loading entities. Please check your connection.</div>';
                    }
                });
        } else {
            console.error('[ATHENA] AthenaService not available');
            if (loadingIndicator) loadingIndicator.style.display = 'none';
            if (entityList) {
                entityList.style.display = 'block';
                entityList.innerHTML = '<div class="athena__error-state">Entity service not available.</div>';
            }
        }
    }
    
    // Create entity element
    function createEntityElement(entity) {
        const div = document.createElement('div');
        div.className = 'athena__entity-item';
        div.dataset.entityId = entity.id;
        
        // Determine icon based on entity type
        const typeIcons = {
            person: '👤',
            project: '📂',
            document: '📄',
            concept: '💡',
            organization: '🏢'
        };
        const icon = typeIcons[entity.type] || '📌';
        
        div.innerHTML = `
            <div class="athena__entity-type-icon athena__entity-type-icon--${entity.type}">${icon}</div>
            <div class="athena__entity-details">
                <div class="athena__entity-name">${entity.name || 'Unnamed Entity'}</div>
                <div class="athena__entity-type">${entity.type || 'Unknown'}</div>
                <div class="athena__entity-properties">${entity.description || entity.properties?.description || 'No description'}</div>
            </div>
            <div class="athena__entity-actions">
                <button class="athena__entity-action-btn" data-action="view" data-entity-id="${entity.id}">View</button>
                <button class="athena__entity-action-btn" data-action="edit" data-entity-id="${entity.id}">Edit</button>
                <button class="athena__entity-action-btn athena__entity-action-btn--danger" data-action="delete" data-entity-id="${entity.id}">Delete</button>
            </div>
        `;
        
        return div;
    }
    
    // Handle entity actions
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('athena__entity-action-btn')) {
            const action = e.target.dataset.action;
            const entityId = e.target.dataset.entityId;
            
            console.log('[ATHENA] Entity action:', action, entityId);
            
            switch (action) {
                case 'view':
                    viewEntity(entityId);
                    break;
                case 'edit':
                    editEntity(entityId);
                    break;
                case 'delete':
                    deleteEntity(entityId);
                    break;
            }
        }
    });
    
    // View entity
    function viewEntity(entityId) {
        console.log('[ATHENA] Viewing entity:', entityId);
        // TODO: Show entity details in a modal or panel
        alert(`View entity ${entityId} - Feature coming soon!`);
    }
    
    // Edit entity
    function editEntity(entityId) {
        console.log('[ATHENA] Editing entity:', entityId);
        // TODO: Show entity edit form
        alert(`Edit entity ${entityId} - Feature coming soon!`);
    }
    
    // Delete entity
    function deleteEntity(entityId) {
        if (confirm('Are you sure you want to delete this entity?')) {
            console.log('[ATHENA] Deleting entity:', entityId);
            
            if (window.AthenaService) {
                window.AthenaService.deleteEntity(entityId)
                    .then(result => {
                        if (result.status === 'success') {
                            // Reload entities
                            loadEntities();
                        } else {
                            alert('Failed to delete entity. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('[ATHENA] Error deleting entity:', error);
                        alert('Error deleting entity. Please try again.');
                    });
            }
        }
    }
    
    // Add entity button handler
    const addEntityBtn = document.getElementById('add-entity-btn');
    if (addEntityBtn) {
        addEntityBtn.addEventListener('click', function() {
            console.log('[ATHENA] Add entity clicked');
            // TODO: Show add entity form
            alert('Add entity feature coming soon!');
        });
    }
    
    // Search entities
    const entitySearchBtn = document.getElementById('entity-search-btn');
    if (entitySearchBtn) {
        entitySearchBtn.addEventListener('click', function() {
            const searchInput = document.getElementById('entity-search');
            const query = searchInput ? searchInput.value.trim() : '';
            
            if (query) {
                console.log('[ATHENA] Searching entities:', query);
                
                if (window.AthenaService) {
                    window.AthenaService.searchEntities(query)
                        .then(result => {
                            console.log('[ATHENA] Search results:', result);
                            // Update entity list with search results
                            // TODO: Implement search results display
                        })
                        .catch(error => {
                            console.error('[ATHENA] Search error:', error);
                        });
                }
            }
        });
    }
    
    // Listen for tab changes via radio buttons
    document.addEventListener('change', function(e) {
        if (e.target.name === 'athena-tab' && e.target.id === 'athena-tab-entities') {
            console.log('[ATHENA] Entities tab selected, loading entities');
            loadEntities();
        }
    });
    
    // Check if entities tab is initially selected
    const entitiesRadio = document.getElementById('athena-tab-entities');
    if (entitiesRadio && entitiesRadio.checked) {
        console.log('[ATHENA] Entities tab initially selected, loading entities');
        loadEntities();
    }
})();

// Knowledge Graph functionality
(function() {
    'use strict';
    console.log('[ATHENA] Setting up knowledge graph functionality');
    
    // Load graph data
    function loadGraphData(filters = {}) {
        console.log('[ATHENA] Loading graph data with filters:', filters);
        
        const graphContainer = document.getElementById('graph-container');
        const placeholder = document.getElementById('graph-placeholder');
        
        if (!graphContainer) {
            console.error('[ATHENA] Graph container not found');
            return;
        }
        
        // Show loading state
        if (placeholder) {
            placeholder.innerHTML = `
                <div class="athena__placeholder-content">
                    <div class="athena__loading-indicator">
                        <div class="athena__spinner"></div>
                        <div class="athena__loading-text">Loading knowledge graph...</div>
                    </div>
                </div>
            `;
        }
        
        // Fetch graph data from API
        if (window.AthenaService) {
            window.AthenaService.getGraphData(filters)
                .then(result => {
                    console.log('[ATHENA] Graph data loaded:', result);
                    
                    // API returns the data directly, not wrapped
                    if (result && (result.entities || result.nodes)) {
                        displayGraphData(result);
                    } else {
                        if (placeholder) {
                            placeholder.innerHTML = `
                                <div class="athena__placeholder-content">
                                    <div class="athena__error-state">Failed to load graph data. Please try again.</div>
                                </div>
                            `;
                        }
                    }
                })
                .catch(error => {
                    console.error('[ATHENA] Error loading graph data:', error);
                    if (placeholder) {
                        placeholder.innerHTML = `
                            <div class="athena__placeholder-content">
                                <div class="athena__error-state">Error loading graph. Please check your connection.</div>
                            </div>
                        `;
                    }
                });
        } else {
            console.error('[ATHENA] AthenaService not available');
            if (placeholder) {
                placeholder.innerHTML = `
                    <div class="athena__placeholder-content">
                        <div class="athena__error-state">Graph service not available.</div>
                    </div>
                `;
            }
        }
    }
    
    // Display graph data (simplified for now)
    function displayGraphData(data) {
        const placeholder = document.getElementById('graph-placeholder');
        if (!placeholder) return;
        
        // API returns entities and relationships, not nodes and edges
        const nodes = data.entities || data.nodes || [];
        const edges = data.relationships || data.edges || [];
        
        console.log('[ATHENA] Displaying graph:', nodes.length, 'entities,', edges.length, 'relationships');
        
        // Simple text representation for now
        // In production, this would render an interactive graph
        placeholder.innerHTML = `
            <div class="athena__placeholder-content">
                <h3 class="athena__placeholder-title">Knowledge Graph</h3>
                <div style="text-align: left; padding: 20px;">
                    <p><strong>Nodes:</strong> ${nodes.length}</p>
                    <p><strong>Edges:</strong> ${edges.length}</p>
                    <hr style="margin: 20px 0; border-color: #444;">
                    <p style="color: #a0a0a0; font-style: italic;">
                        Interactive graph visualization will be implemented with D3.js
                    </p>
                    ${nodes.length > 0 ? `
                        <h4 style="margin-top: 20px;">Sample Nodes:</h4>
                        <ul style="list-style: none; padding: 0;">
                            ${nodes.slice(0, 5).map(node => `
                                <li style="padding: 5px 0;">
                                    <span style="color: #7B1FA2;">●</span> 
                                    ${node.label || node.name || node.id} 
                                    <span style="color: #666;">(${node.type || 'unknown'})</span>
                                </li>
                            `).join('')}
                            ${nodes.length > 5 ? `<li style="color: #666;">... and ${nodes.length - 5} more</li>` : ''}
                        </ul>
                    ` : ''}
                </div>
            </div>
        `;
    }
    
    // Graph search functionality
    const graphSearchBtn = document.getElementById('graph-search-btn');
    if (graphSearchBtn) {
        graphSearchBtn.addEventListener('click', function() {
            const searchInput = document.getElementById('graph-search');
            const query = searchInput ? searchInput.value.trim() : '';
            
            if (query) {
                console.log('[ATHENA] Searching graph for:', query);
                loadGraphData({ search: query });
            }
        });
    }
    
    // Entity type filter
    const applyFilterBtn = document.getElementById('apply-filter-btn');
    if (applyFilterBtn) {
        applyFilterBtn.addEventListener('click', function() {
            const typeFilter = document.getElementById('entity-type-filter');
            const entityType = typeFilter ? typeFilter.value : 'all';
            
            console.log('[ATHENA] Applying filter:', entityType);
            const filters = entityType !== 'all' ? { type: entityType } : {};
            loadGraphData(filters);
        });
    }
    
    // Listen for tab changes via radio buttons
    document.addEventListener('change', function(e) {
        if (e.target.name === 'athena-tab' && e.target.id === 'athena-tab-graph') {
            console.log('[ATHENA] Graph tab selected, loading graph data');
            loadGraphData();
        }
    });
    
    // Check if graph tab is initially selected (it's the default)
    const graphRadio = document.getElementById('athena-tab-graph');
    if (graphRadio && graphRadio.checked) {
        console.log('[ATHENA] Graph tab initially selected, loading graph data');
        // Delay initial load slightly to ensure service is ready
        setTimeout(() => loadGraphData(), 100);
    }
})();

// Query Builder functionality
(function() {
    'use strict';
    console.log('[ATHENA] Setting up query builder functionality');
    
    // Build query from form inputs
    function buildQuery() {
        const entityType = document.getElementById('entity-type-select')?.value || 'any';
        const relationshipType = document.getElementById('relationship-type-select')?.value || 'any';
        const searchTerms = document.getElementById('search-terms-input')?.value || '';
        const includeArchived = document.getElementById('include-archived')?.checked || false;
        const exactMatch = document.getElementById('exact-match')?.checked || false;
        
        console.log('[ATHENA] Building query with:', {
            entityType,
            relationshipType,
            searchTerms,
            includeArchived,
            exactMatch
        });
        
        // Build query object
        const query = {
            type: entityType !== 'any' ? entityType : undefined,
            relationship: relationshipType !== 'any' ? relationshipType : undefined,
            search: searchTerms || undefined,
            includeArchived: includeArchived,
            exactMatch: exactMatch
        };
        
        // Remove undefined values
        Object.keys(query).forEach(key => {
            if (query[key] === undefined) {
                delete query[key];
            }
        });
        
        // Generate query string representation
        const queryString = JSON.stringify(query, null, 2);
        
        // Show the query
        const resultContainer = document.getElementById('query-result-container');
        const queryDisplay = document.getElementById('generated-query');
        
        if (resultContainer && queryDisplay) {
            queryDisplay.textContent = queryString;
            resultContainer.style.display = 'block';
        }
        
        return query;
    }
    
    // Execute query
    function executeQuery() {
        const query = buildQuery();
        console.log('[ATHENA] Executing query:', query);
        
        if (window.AthenaService) {
            // Show loading state
            const queryDisplay = document.getElementById('generated-query');
            if (queryDisplay) {
                queryDisplay.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div class="athena__spinner" style="margin: 0 auto;"></div>
                        <div style="margin-top: 10px; color: #a0a0a0;">Executing query...</div>
                    </div>
                `;
            }
            
            window.AthenaService.executeQuery(query)
                .then(result => {
                    console.log('[ATHENA] Query results:', result);
                    
                    if (result.status === 'success' && result.data) {
                        displayQueryResults(result.data);
                    } else {
                        if (queryDisplay) {
                            queryDisplay.innerHTML = `
                                <div style="color: #ff6b6b; padding: 20px; text-align: center;">
                                    Failed to execute query. Please try again.
                                </div>
                            `;
                        }
                    }
                })
                .catch(error => {
                    console.error('[ATHENA] Query execution error:', error);
                    if (queryDisplay) {
                        queryDisplay.innerHTML = `
                            <div style="color: #ff6b6b; padding: 20px; text-align: center;">
                                Error executing query: ${error.message || 'Unknown error'}
                            </div>
                        `;
                    }
                });
        }
    }
    
    // Display query results
    function displayQueryResults(data) {
        const queryDisplay = document.getElementById('generated-query');
        if (!queryDisplay) return;
        
        const results = Array.isArray(data) ? data : data.results || [];
        
        if (results.length === 0) {
            queryDisplay.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #a0a0a0;">
                    No results found for this query.
                </div>
            `;
            return;
        }
        
        // Display results
        queryDisplay.innerHTML = `
            <div style="padding: 10px;">
                <div style="margin-bottom: 10px; color: #7B1FA2;">
                    Found ${results.length} result${results.length !== 1 ? 's' : ''}:
                </div>
                <div style="max-height: 300px; overflow-y: auto;">
                    ${results.map(item => `
                        <div style="padding: 10px; margin-bottom: 8px; background: rgba(123, 31, 162, 0.05); border-radius: 4px; border-left: 3px solid #7B1FA2;">
                            <div style="font-weight: 500;">${item.name || item.label || item.id}</div>
                            <div style="font-size: 0.9em; color: #a0a0a0;">
                                Type: ${item.type || 'unknown'}
                                ${item.properties ? ` | Properties: ${Object.keys(item.properties).length}` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Clear query form
    function clearQuery() {
        console.log('[ATHENA] Clearing query form');
        
        // Reset form inputs
        const entityType = document.getElementById('entity-type-select');
        const relationshipType = document.getElementById('relationship-type-select');
        const searchTerms = document.getElementById('search-terms-input');
        const includeArchived = document.getElementById('include-archived');
        const exactMatch = document.getElementById('exact-match');
        
        if (entityType) entityType.value = 'any';
        if (relationshipType) relationshipType.value = 'any';
        if (searchTerms) searchTerms.value = '';
        if (includeArchived) includeArchived.checked = false;
        if (exactMatch) exactMatch.checked = false;
        
        // Hide result container
        const resultContainer = document.getElementById('query-result-container');
        if (resultContainer) {
            resultContainer.style.display = 'none';
        }
    }
    
    // Copy query to clipboard
    function copyQuery() {
        const queryDisplay = document.getElementById('generated-query');
        if (queryDisplay) {
            const queryText = queryDisplay.textContent;
            navigator.clipboard.writeText(queryText)
                .then(() => {
                    console.log('[ATHENA] Query copied to clipboard');
                    // Show feedback
                    const copyBtn = document.getElementById('copy-query-btn');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'Copied!';
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 2000);
                    }
                })
                .catch(err => {
                    console.error('[ATHENA] Failed to copy query:', err);
                });
        }
    }
    
    // Set up event handlers
    const buildQueryBtn = document.getElementById('build-query-btn');
    if (buildQueryBtn) {
        buildQueryBtn.addEventListener('click', function(e) {
            e.preventDefault();
            buildQuery();
        });
    }
    
    const executeQueryBtn = document.getElementById('execute-query-btn');
    if (executeQueryBtn) {
        executeQueryBtn.addEventListener('click', function(e) {
            e.preventDefault();
            executeQuery();
        });
    }
    
    const clearQueryBtn = document.getElementById('clear-query-btn');
    if (clearQueryBtn) {
        clearQueryBtn.addEventListener('click', function(e) {
            e.preventDefault();
            clearQuery();
        });
    }
    
    const copyQueryBtn = document.getElementById('copy-query-btn');
    if (copyQueryBtn) {
        copyQueryBtn.addEventListener('click', function(e) {
            e.preventDefault();
            copyQuery();
        });
    }
    
    // Enter key support for search terms
    const searchTermsInput = document.getElementById('search-terms-input');
    if (searchTermsInput) {
        searchTermsInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buildQuery();
            }
        });
    }
})();
</script>