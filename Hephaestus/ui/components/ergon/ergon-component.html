<!-- Ergon Component - Agent Management and LLM Integration -->
<!-- @landmark Component: Ergon - Agent builder, tools manager, and MCP connections hub -->

<!-- Hidden radio inputs for CSS-first tab functionality -->
<!-- @landmark Navigation: CSS-first radio buttons for tab switching -->
<input type="radio" name="ergon-tab" id="ergon-tab-agents" checked style="display: none;">
<input type="radio" name="ergon-tab" id="ergon-tab-tools" style="display: none;">
<input type="radio" name="ergon-tab" id="ergon-tab-mcp" style="display: none;">
<input type="radio" name="ergon-tab" id="ergon-tab-memory" style="display: none;">
<input type="radio" name="ergon-tab" id="ergon-tab-chat" style="display: none;">
<input type="radio" name="ergon-tab" id="ergon-tab-teamchat" style="display: none;">
<div class="ergon" data-tekton-area="ergon" data-tekton-component="ergon" data-tekton-type="component-workspace" data-tekton-ai="ergon-assistant" data-tekton-ai-ready="false">
    <!-- Component Header with Title -->
    <!-- @landmark Header: Component title and branding -->
    <div class="ergon__header" data-tekton-zone="header" data-tekton-section="header">
        <div class="ergon__title-container">
            <img src="/images/hexagon.jpg" alt="Tekton" class="ergon__icon">
            <h2 class="ergon__title">
                <span class="ergon__title-main">Ergon</span>
                <span class="ergon__title-sub">Agents/Tools/MCP</span>
            </h2>
        </div>
    </div>

    <!-- Ergon Menu Bar with Tab Navigation -->
    <!-- @landmark Menu: Tab navigation for 6 component views -->
    <div class="ergon__menu-bar" data-tekton-zone="menu" data-tekton-nav="component-menu">
        <div class="ergon__tabs" data-tekton-zone="menu">
            <label for="ergon-tab-agents" class="ergon__tab" data-tab="agents" 
                 data-tekton-menu-item="Agents" 
                 data-tekton-menu-component="ergon" 
                 data-tekton-menu-panel="agents-panel" 
                 data-tekton-nav-target="agents">
                <span class="ergon__tab-label">Agents</span>
            </label>
            <label for="ergon-tab-tools" class="ergon__tab" data-tab="tools" 
                 data-tekton-menu-item="Tools" 
                 data-tekton-menu-component="ergon" 
                 data-tekton-menu-panel="tools-panel" 
                 data-tekton-nav-target="tools">
                <span class="ergon__tab-label">Tools</span>
            </label>
            <label for="ergon-tab-mcp" class="ergon__tab" data-tab="mcp" 
                 data-tekton-menu-item="MCP" 
                 data-tekton-menu-component="ergon" 
                 data-tekton-menu-panel="mcp-panel" 
                 data-tekton-nav-target="mcp">
                <span class="ergon__tab-label">MCP</span>
            </label>
            <label for="ergon-tab-memory" class="ergon__tab" data-tab="memory" 
                 data-tekton-menu-item="Memory" 
                 data-tekton-menu-component="ergon" 
                 data-tekton-menu-panel="memory-panel" 
                 data-tekton-nav-target="memory">
                <span class="ergon__tab-label">Memory</span>
            </label>
            <label for="ergon-tab-chat" class="ergon__tab" data-tab="chat" 
                 data-tekton-menu-item="Tool Chat" 
                 data-tekton-menu-component="ergon" 
                 data-tekton-menu-panel="ergon-panel" 
                 data-tekton-nav-target="chat">
                <span class="ergon__tab-label">Tool Chat</span>
            </label>
            <label for="ergon-tab-teamchat" class="ergon__tab" data-tab="teamchat" 
                 data-tekton-menu-item="Team Chat" 
                 data-tekton-menu-component="ergon" 
                 data-tekton-menu-panel="awt-team-panel" 
                 data-tekton-nav-target="teamchat">
                <span class="ergon__tab-label">Team Chat</span>
            </label>
        </div>
        <div class="ergon__actions">
            <button id="clear-chat-btn" class="ergon__action-button" style="display: none;" data-tekton-action="clear-chat" data-tekton-action-type="secondary">
                <span class="ergon__button-label">Clear</span>
            </button>
            <button id="create-agent-button" class="ergon__action-button" data-tekton-action="create-agent" data-tekton-action-type="primary">
                <span class="ergon__button-label">Create Agent</span>
            </button>
        </div>
    </div>
    
    <!-- Ergon Content Area -->
    <!-- @landmark Content: Main content area with 6 tab panels -->
    <div class="ergon__content" data-tekton-zone="content" data-tekton-scrollable="true">
        <!-- Agents Tab (Default Active Tab) -->
        <!-- @landmark Panel: Agents - Create and manage AI agents -->
        <div id="agents-panel" class="ergon__panel" data-tekton-panel="agents" data-tekton-panel-for="Agents" data-tekton-panel-component="ergon">
            <div class="ergon__agent-grid" id="agent-grid">
                <!-- Agents will be loaded here dynamically -->
                <div class="ergon__loading-message" id="agents-loading">
                    <div class="ergon__message-text">Loading agents...</div>
                </div>
            </div>

            <!-- Agent Creation Form (initially hidden) -->
            <div id="agent-creation-form" class="ergon__modal-form" style="display: none;">
                <div class="ergon__modal-content">
                    <h3 class="ergon__modal-title">Create New Agent</h3>
                    <div class="ergon__form-group">
                        <label for="agent-name" class="ergon__form-label">Agent Name:</label>
                        <input type="text" id="agent-name" class="ergon__form-input" placeholder="Enter agent name">
                    </div>
                    <div class="ergon__form-group">
                        <label for="agent-type" class="ergon__form-label">Agent Type:</label>
                        <select id="agent-type" class="ergon__form-select">
                            <option value="general">General Purpose</option>
                            <option value="code">Code Assistant</option>
                            <option value="data">Data Analyst</option>
                            <option value="research">Research Assistant</option>
                        </select>
                    </div>
                    <div class="ergon__form-group">
                        <label for="agent-description" class="ergon__form-label">Description:</label>
                        <textarea id="agent-description" class="ergon__form-textarea" placeholder="Describe the agent's purpose"></textarea>
                    </div>
                    <div class="ergon__form-actions">
                        <button id="cancel-creation" class="ergon__button ergon__button--cancel" data-tekton-action="cancel-creation" data-tekton-action-type="secondary">Cancel</button>
                        <button id="submit-creation" class="ergon__button ergon__button--submit" data-tekton-action="submit-creation" data-tekton-action-type="primary">Create</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tool Chat Tab -->
        <!-- @landmark Panel: Tool Chat - Direct chat with Ergon AI assistant -->
        <div id="ergon-panel" class="ergon__panel" data-tekton-panel="ergon" data-tekton-panel-for="Tool Chat" data-tekton-panel-component="ergon">
            <div id="ergon-messages" class="ergon__chat-messages">
                <!-- Welcome message -->
                <div class="ergon__message ergon__message--system">
                    <div class="ergon__message-content">
                        <div class="ergon__message-text">
                            <h3 class="ergon__message-title">Welcome to Ergon AI Assistant</h3>
                            <p>I specialize in agent management, workflow automation, and tool configuration. How can I assist you today?</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Team Chat Tab -->
        <!-- @landmark Panel: Team Chat - Collaborate with all Tekton AI assistants -->
        <div id="awt-team-panel" class="ergon__panel" data-tekton-panel="awt-team" data-tekton-panel-for="Team Chat" data-tekton-panel-component="ergon">
            <div id="awt-team-messages" class="ergon__chat-messages">
                <!-- Welcome message -->
                <div class="ergon__message ergon__message--system">
                    <div class="ergon__message-content">
                        <div class="ergon__message-text">
                            <h3 class="ergon__message-title">Tekton Team Chat</h3>
                            <p>This chat is shared across all Tekton components. Use this for team communication and coordination.</p>
                        </div>
                    </div>
                </div>
                <!-- Team messages will appear here dynamically -->
            </div>
        </div>
        
        <!-- Memory Tab -->
        <!-- @landmark Panel: Memory - Manage agent memory and context -->
        <div id="memory-panel" class="ergon__panel" data-tekton-panel="memory" data-tekton-panel-for="Memory" data-tekton-panel-component="ergon">
            <div class="ergon__panel-section">
                <h3 class="ergon__section-title">Memory Management</h3>
                <p class="ergon__section-description">This panel allows you to manage agent memory and context.</p>
                
                <div class="ergon__memory-stats" id="memory-stats">
                    <div class="ergon__memory-stat">
                        <div class="ergon__stat-label">Active Memories</div>
                        <div class="ergon__stat-value" id="memory-active-count">--</div>
                    </div>
                    <div class="ergon__memory-stat">
                        <div class="ergon__stat-label">Total Storage</div>
                        <div class="ergon__stat-value" id="memory-storage-size">--</div>
                    </div>
                    <div class="ergon__memory-stat">
                        <div class="ergon__stat-label">Retention Period</div>
                        <div class="ergon__stat-value" id="memory-retention">--</div>
                    </div>
                </div>
                
                <div class="ergon__memory-actions">
                    <button class="ergon__action-button" data-tekton-action="view-memories" data-tekton-action-type="secondary">View Memories</button>
                    <button class="ergon__action-button" data-tekton-action="clear-all" data-tekton-action-type="secondary">Clear All</button>
                </div>
            </div>
        </div>
        
        <!-- Tools Tab -->
        <!-- @landmark Panel: Tools - Configure tools available to agents -->
        <div id="tools-panel" class="ergon__panel" data-tekton-panel="tools" data-tekton-panel-for="Tools" data-tekton-panel-component="ergon">
            <div class="ergon__panel-section">
                <h3 class="ergon__section-title">Available Tools</h3>
                <p class="ergon__section-description">Manage tools that agents can use.</p>

                <div class="ergon__tools-list" id="tools-list">
                    <!-- Tools will be loaded here dynamically -->
                    <div class="ergon__loading-message" id="tools-loading">
                        <div class="ergon__message-text">Loading available tools...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MCP Tab (Multi-Cloud Platform) -->
        <!-- @landmark Panel: MCP - Manage Model Context Protocol connections -->
        <div id="mcp-panel" class="ergon__panel" data-tekton-panel="mcp" data-tekton-panel-for="MCP" data-tekton-panel-component="ergon">
            <div class="ergon__panel-section">
                <h3 class="ergon__section-title">MCP Connections</h3>
                <p class="ergon__section-description">Configure and manage connections to Multi-Cloud Platforms.</p>

                <div class="ergon__mcp-stats" id="mcp-stats">
                    <div class="ergon__mcp-stat">
                        <div class="ergon__stat-label">Active Connections</div>
                        <div class="ergon__stat-value" id="mcp-active-count">--</div>
                    </div>
                    <div class="ergon__mcp-stat">
                        <div class="ergon__stat-label">Available Models</div>
                        <div class="ergon__stat-value" id="mcp-models-count">--</div>
                    </div>
                    <div class="ergon__mcp-stat">
                        <div class="ergon__stat-label">Token Usage</div>
                        <div class="ergon__stat-value" id="mcp-token-usage">--</div>
                    </div>
                </div>

                <h4 class="ergon__subsection-title">Connection Status</h4>
                <div class="ergon__mcp-connections" id="mcp-connections">
                    <!-- MCP connections will be loaded here dynamically -->
                    <div class="ergon__loading-message" id="mcp-loading">
                        <div class="ergon__message-text">Loading MCP connections...</div>
                    </div>
                </div>

                <div class="ergon__mcp-actions">
                    <button class="ergon__action-button" data-tekton-action="add-connection" data-tekton-action-type="primary">Add Connection</button>
                    <button class="ergon__action-button" data-tekton-action="refresh-status" data-tekton-action-type="secondary">Refresh Status</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer with Chat Input -->
    <!-- @landmark Footer: Chat input area -->
    <div class="ergon__footer" data-tekton-zone="footer">
        <div class="ergon__chat-input-container">
            <div class="ergon__chat-prompt">></div>
            <input type="text" id="ergon-chat-input" class="ergon__chat-input" 
                   data-tekton-input="chat-input"
                   data-tekton-input-type="chat"
                   placeholder="Enter chat message for Ergon agent management, tools configuration, or MCP"
                   onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); ergon_sendChat(); }">
            <button id="ergon-send-button" class="ergon__send-button"
                    data-tekton-action="send-message" 
                    data-tekton-action-type="primary"
                    onclick="ergon_sendChat(); return false;">Send</button>
        </div>
    </div>
</div>

<!-- Add component-specific styles -->
<style>
    /* Ergon component styles using BEM naming convention */
    
    /* Container */
    .ergon {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        background-color: var(--bg-primary, #1e1e2e);
        color: var(--text-primary, #f0f0f0);
        position: relative; /* Needed for footer positioning */
    }
    
    /* Header */
    .ergon__header {
        display: flex;
        align-items: center;
        padding: 10px 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Standardized header height */
    }
    
    .ergon__title-container {
        display: flex;
        align-items: center;
    }
    
    .ergon__icon {
        height: 30px;
        width: auto;
        margin-right: 12px;
    }
    
    .ergon__title {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 500;
    }
    
    .ergon__title-sub {
        margin-left: 8px;
        opacity: 0.8;
        font-weight: normal;
    }
    
    /* Menu Bar */
    .ergon__menu-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Standardized menu bar height */
    }
    
    .ergon__tabs {
        display: flex;
        gap: 8px;
    }
    
    .ergon__tab {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background-color: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    /* CSS-first navigation - radio button controls active state */
    #ergon-tab-agents:checked ~ .ergon .ergon__tab[data-tab="agents"],
    #ergon-tab-tools:checked ~ .ergon .ergon__tab[data-tab="tools"],
    #ergon-tab-mcp:checked ~ .ergon .ergon__tab[data-tab="mcp"],
    #ergon-tab-memory:checked ~ .ergon .ergon__tab[data-tab="memory"],
    #ergon-tab-chat:checked ~ .ergon .ergon__tab[data-tab="chat"],
    #ergon-tab-teamchat:checked ~ .ergon .ergon__tab[data-tab="teamchat"] {
        border-bottom-color: var(--color-primary, #0097A7);
        font-weight: 500;
    }
    
    .ergon__tab:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }
    
    /* Active tab styling now handled by CSS-first selectors above */
    
    .ergon__actions {
        display: flex;
        gap: 8px;
    }
    
    .ergon__action-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .ergon__action-button:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }
    
    /* Content Area */
    .ergon__content {
        flex: 1;
        overflow: hidden;
        position: relative;
        margin-bottom: 70px; /* Space for footer */
    }
    
    .ergon__panel {
        display: none;
        height: 100%;
        width: 100%;
        overflow: auto;
        position: relative;
    }
    
    /* CSS-first panel visibility */
    #ergon-tab-agents:checked ~ .ergon #agents-panel,
    #ergon-tab-tools:checked ~ .ergon #tools-panel,
    #ergon-tab-mcp:checked ~ .ergon #mcp-panel,
    #ergon-tab-memory:checked ~ .ergon #memory-panel,
    #ergon-tab-chat:checked ~ .ergon #ergon-panel,
    #ergon-tab-teamchat:checked ~ .ergon #awt-team-panel {
        display: block;
    }
    
    /* Agent Grid Layout */
    .ergon__agent-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
        padding: 1rem;
    }
    
    .ergon__agent-card {
        background-color: var(--bg-card, #2d2d2d);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        box-shadow: var(--box-shadow-sm, 0 2px 4px rgba(0, 0, 0, 0.1));
        transition: all 0.2s ease;
    }
    
    .ergon__agent-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-md, 0 4px 8px rgba(0, 0, 0, 0.1));
    }
    
    .ergon__agent-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .ergon__agent-name {
        font-weight: bold;
        font-size: 1.1rem;
    }
    
    .ergon__agent-status {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--color-secondary, #6c757d);
    }
    
    .ergon__agent-status--active {
        background-color: var(--color-success, #28a745);
        box-shadow: 0 0 5px var(--color-success, #28a745);
    }
    
    .ergon__agent-description {
        margin-bottom: 1rem;
        color: var(--text-secondary, #aaa);
        flex: 1;
    }
    
    .ergon__agent-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
    }
    
    .ergon__agent-action-button {
        padding: 0.25rem 0.75rem;
        background-color: var(--bg-tertiary, #333);
        border: none;
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .ergon__agent-action-button:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }
    
    /* Modal Form Styling */
    .ergon__modal-form {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }
    
    .ergon__modal-content {
        background-color: var(--bg-card, #2d2d2d);
        border-radius: 8px;
        padding: 1.5rem;
        width: 100%;
        max-width: 500px;
        box-shadow: var(--box-shadow-lg, 0 8px 16px rgba(0, 0, 0, 0.1));
    }
    
    .ergon__modal-title {
        margin-top: 0;
        margin-bottom: 1rem;
    }
    
    .ergon__form-group {
        margin-bottom: 1rem;
    }
    
    .ergon__form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    
    .ergon__form-input,
    .ergon__form-select,
    .ergon__form-textarea {
        width: 100%;
        padding: 0.5rem;
        background-color: var(--bg-tertiary, #333);
        border: 1px solid var(--border-color, #444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
    }
    
    .ergon__form-textarea {
        min-height: 100px;
        resize: vertical;
    }
    
    .ergon__form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .ergon__button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .ergon__button--cancel {
        background-color: var(--bg-tertiary, #333);
        color: var(--text-primary, #f0f0f0);
    }
    
    .ergon__button--submit {
        background-color: var(--color-primary, #007bff);
        color: white;
    }
    
    /* Chat Messages */
    .ergon__chat-messages {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0; /* Full height since content has margin for footer */
        overflow-y: auto;
        padding: 16px;
        padding-bottom: 16px; /* Some space at bottom */
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .ergon__message {
        border-radius: 8px;
        padding: 12px 16px;
        max-width: 85%;
        word-wrap: break-word;
        line-height: 1.4;
        margin: 4px 0; /* Add vertical spacing */
    }
    
    .ergon__message--system {
        background-color: rgba(0, 151, 167, 0.05); /* Light teal background for system messages */
        align-self: center;
        max-width: 90%;
        width: 600px;
        margin: 8px 0;
        border-radius: 8px;
        padding: 16px 24px;
        border-left: 3px solid #0097A7;
    }
    
    .ergon__message--user {
        background-color: rgba(76, 175, 80, 0.05); /* Light green background */
        color: var(--text-primary, #f0f0f0);
        align-self: flex-end;
        border-left: 3px solid #4CAF50; /* Green border for user messages */
        border-radius: 8px;
    }
    
    .ergon__message--ai {
        background-color: rgba(0, 151, 167, 0.05); /* Light teal background with 0.05 opacity */
        color: var(--text-primary, #f0f0f0);
        align-self: flex-start;
        border-left: 3px solid #0097A7; /* Teal border for AI messages */
        border-radius: 8px;
    }
    
    .ergon__message-content {
        display: flex;
        flex-direction: column;
    }
    
    .ergon__message-text {
        margin-bottom: 0.25rem;
    }
    
    .ergon__message-title {
        margin-top: 0;
        margin-bottom: 0.5rem;
    }
    
    .ergon__message-time {
        font-size: 0.8rem;
        color: var(--text-secondary, #aaa);
        align-self: flex-end;
    }
    
    /* Chat Input - Fixed at bottom, always visible */
    .ergon__footer {
        background-color: var(--bg-secondary, #252535);
        border-top: 1px solid var(--border-color, #444444);
        padding: 12px 16px;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 70px;
        z-index: 10; /* Ensure it stays above content */
        display: block !important; /* Always visible */
    }
    
    .ergon__chat-input-container {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%;
    }
    
    .ergon__chat-prompt {
        font-size: 18px;
        font-weight: bold;
        color: #0097A7; /* Changed to Ergon teal theme color */
    }
    
    .ergon__chat-input {
        flex: 1;
        height: 44px;
        padding: 8px 16px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 8px;
        color: var(--text-primary, #f0f0f0);
        font-size: 14px;
    }
    
    .ergon__send-button {
        height: 44px;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #0097A7; /* Teal color for Ergon */
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .ergon__send-button:hover {
        background-color: #007A8A; /* Darker teal on hover */
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 151, 167, 0.3);
    }
    
    .ergon__send-button:active {
        transform: translateY(0);
        box-shadow: none;
    }
    
    /* Panel Section Styling */
    .ergon__panel-section {
        padding: 1rem;
    }
    
    .ergon__section-title {
        margin-top: 0;
        margin-bottom: 0.75rem;
    }
    
    .ergon__section-description {
        margin-top: 0;
        margin-bottom: 1.5rem;
        color: var(--text-secondary, #aaa);
    }
    
    /* Memory Tab Styling */
    .ergon__memory-stats,
    .ergon__mcp-stats {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        margin: 1rem 0;
    }
    
    .ergon__memory-stat,
    .ergon__mcp-stat {
        flex: 1;
        background-color: var(--bg-card, #2d2d2d);
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
    }
    
    .ergon__stat-label {
        color: var(--text-secondary, #aaa);
        margin-bottom: 0.5rem;
    }
    
    .ergon__stat-value {
        font-size: 1.5rem;
        font-weight: bold;
    }
    
    .ergon__memory-actions,
    .ergon__mcp-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    /* Tools Tab Styling */
    .ergon__tools-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .ergon__tool-item {
        background-color: var(--bg-card, #2d2d2d);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .ergon__tool-name {
        font-weight: bold;
        min-width: 150px;
    }
    
    .ergon__tool-status {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--color-secondary, #6c757d);
    }
    
    .ergon__tool-status--active {
        background-color: var(--color-success, #28a745);
        box-shadow: 0 0 5px var(--color-success, #28a745);
    }
    
    .ergon__tool-description {
        flex: 1;
        color: var(--text-secondary, #aaa);
    }
    
    /* MCP Tab Styling */
    .ergon__subsection-title {
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
    }
    
    .ergon__mcp-connections {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .ergon__mcp-connection {
        background-color: var(--bg-card, #2d2d2d);
        border-radius: 8px;
        padding: 1rem;
    }
    
    .ergon__connection-name {
        font-weight: bold;
        margin-bottom: 0.25rem;
    }
    
    .ergon__connection-status {
        color: var(--color-secondary, #6c757d);
        margin-bottom: 0.25rem;
    }
    
    .ergon__connection-status--active {
        color: var(--color-success, #28a745);
    }
    
    .ergon__connection-models {
        color: var(--text-secondary, #aaa);
        font-size: 0.9em;
    }
    
    /* Loading indicator animation */
    .ergon__message--typing .ergon__message-text::after {
        content: "";
        display: inline-block;
        animation: ergon-ellipsis 1.5s infinite;
        width: 12px;
        text-align: left;
    }
    
    @keyframes ergon-ellipsis {
        0% { content: "."; }
        33% { content: ".."; }
        66% { content: "..."; }
    }
    
    /* Loading, empty and error messages */
    .ergon__loading-message,
    .ergon__empty-message,
    .ergon__error-message {
        text-align: center;
        padding: 2rem;
        color: var(--text-secondary, #aaa);
        font-style: italic;
    }
    
    .ergon__error-message {
        color: var(--color-danger, #dc3545);
    }
</style>

<script src="/scripts/tekton-urls.js"></script>
<script src="/scripts/shared/ai-chat.js"></script>
<script src="/scripts/ergon-service.js"></script>
<script type="text/javascript">
// Update clear button visibility based on active tab
function ergon_updateClearButton() {
    const chatRadio = document.getElementById('ergon-tab-chat');
    const teamchatRadio = document.getElementById('ergon-tab-teamchat');
    const clearButton = document.getElementById('clear-chat-btn');
    
    if (clearButton) {
        if (chatRadio.checked || teamchatRadio.checked) {
            clearButton.style.display = 'block';
        } else {
            clearButton.style.display = 'none';
        }
    }
}

// Listen for tab changes
document.addEventListener('DOMContentLoaded', function() {
    const radioButtons = document.querySelectorAll('input[name="ergon-tab"]');
    radioButtons.forEach(radio => {
        radio.addEventListener('change', ergon_updateClearButton);
    });
    // Initial update
    ergon_updateClearButton();
});

// Chat functionality - CSS-first navigation aware
window.ergon_sendChat = function() {
    const input = document.getElementById('ergon-chat-input');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Determine which tab is active using radio buttons
    const chatRadio = document.getElementById('ergon-tab-chat');
    const teamchatRadio = document.getElementById('ergon-tab-teamchat');
    const chatType = chatRadio.checked ? 'chat' : (teamchatRadio.checked ? 'teamchat' : null);
    
    if (!chatType) {
        console.error('No chat tab is active');
        return;
    }
    
    const messagesContainerId = chatType === 'chat' ? 'ergon-messages' : 'awt-team-messages';
    const messagesContainer = document.getElementById(messagesContainerId);
    
    // Add user message
    const userMessageDiv = document.createElement('div');
    userMessageDiv.className = 'ergon__message ergon__message--user';
    userMessageDiv.innerHTML = `<div class="ergon__message-content"><div class="ergon__message-text">${message}</div></div>`;
    messagesContainer.appendChild(userMessageDiv);
    
    // Clear input
    input.value = '';
    
    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    // Send to backend
    if (chatType === 'chat') {
        // Direct message to ergon
        if (window.AIChat) {
            window.AIChat.sendMessage('ergon', message)
                .then(response => {
                    const aiMessageDiv = document.createElement('div');
                    aiMessageDiv.className = 'ergon__message ergon__message--ai';
                    aiMessageDiv.innerHTML = `<div class="ergon__message-content"><div class="ergon__message-text"><strong>Ergon:</strong> ${response.content}</div></div>`;
                    messagesContainer.appendChild(aiMessageDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                })
                .catch(err => {
                    console.error('Failed to send message:', err);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'ergon__message ergon__message--system';
                    errorDiv.innerHTML = `<div class="ergon__message-content"><div class="ergon__message-text"><strong>System:</strong> Failed to connect to Ergon AI. Make sure aish MCP is running.</div></div>`;
                    messagesContainer.appendChild(errorDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                });
        } else {
            console.error('AIChat not available');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'ergon__message ergon__message--system';
            errorDiv.innerHTML = `<div class="ergon__message-content"><div class="ergon__message-text"><strong>System:</strong> AI Chat service not available</div></div>`;
            messagesContainer.appendChild(errorDiv);
        }
    } else {
        // Team chat
        if (window.AIChat) {
            window.AIChat.teamChat(message, 'ergon')
                .then(data => {
                    // Display team responses
                    if (data.responses && data.responses.length > 0) {
                        data.responses.forEach(resp => {
                            const aiMessageDiv = document.createElement('div');
                            aiMessageDiv.className = 'ergon__message ergon__message--ai';
                            const sender = resp.socket_id.replace('-ai', '').charAt(0).toUpperCase() + 
                                         resp.socket_id.replace('-ai', '').slice(1);
                            aiMessageDiv.innerHTML = `<div class="ergon__message-content"><div class="ergon__message-text"><strong>${sender}:</strong> ${resp.content}</div></div>`;
                            messagesContainer.appendChild(aiMessageDiv);
                        });
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }
                })
                .catch(err => {
                    console.error('Failed to send team message:', err);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'ergon__message ergon__message--system';
                    errorDiv.innerHTML = `<div class="ergon__message-content"><div class="ergon__message-text"><strong>System:</strong> Failed to send team message</div></div>`;
                    messagesContainer.appendChild(errorDiv);
                });
        }
    }
}

// Clear chat functionality - CSS-first aware
function ergon_clearChat() {
    const chatRadio = document.getElementById('ergon-tab-chat');
    const teamchatRadio = document.getElementById('ergon-tab-teamchat');
    
    if (chatRadio.checked) {
        const messagesContainer = document.getElementById('ergon-messages');
        // Keep the welcome message, remove all others
        const messages = messagesContainer.querySelectorAll('.ergon__message:not(.ergon__message--system):first-child');
        const allMessages = messagesContainer.querySelectorAll('.ergon__message');
        allMessages.forEach((msg, index) => {
            if (index > 0) msg.remove(); // Keep first system message
        });
    } else if (teamchatRadio.checked) {
        const messagesContainer = document.getElementById('awt-team-messages');
        // Keep the welcome message, remove all others  
        const allMessages = messagesContainer.querySelectorAll('.ergon__message');
        allMessages.forEach((msg, index) => {
            if (index > 0) msg.remove(); // Keep first system message
        });
    }
}

// Add event listeners for buttons
document.addEventListener('DOMContentLoaded', function() {
    // Send button click and chat input keydown are handled inline in the HTML
    
    const clearButton = document.getElementById('clear-chat-btn');
    if (clearButton) {
        clearButton.addEventListener('click', ergon_clearChat);
    }
});

// Load real data when component initializes
function ergon_loadData() {
    // Load agents
    ergon_loadAgents();
    
    // Load tools
    ergon_loadTools();
    
    // Load MCP connections
    ergon_loadMCPConnections();
    
    // Load memory stats
    ergon_loadMemoryStats();
}

// Load agents from backend using ErgonService
function ergon_loadAgents() {
    console.log('[ERGON] Loading agents');
    const grid = document.getElementById('agent-grid');
    
    // Show loading
    grid.innerHTML = '<div class="ergon__loading-message"><div class="ergon__message-text">Loading agents...</div></div>';
    
    if (window.ErgonService) {
        window.ErgonService.getAgents()
            .then(agents => {
                console.log('[ERGON] Agents loaded:', agents);
                grid.innerHTML = ''; // Clear loading message
                
                if (agents.length === 0) {
                    grid.innerHTML = '<div class="ergon__empty-message">No agents configured. Click "Create Agent" to add one.</div>';
                    return;
                }
                
                agents.forEach(agent => {
                    const card = document.createElement('div');
                    card.className = 'ergon__agent-card';
                    card.innerHTML = `
                        <div class="ergon__agent-header">
                            <div class="ergon__agent-name">${agent.name || 'Unnamed Agent'}</div>
                            <div class="ergon__agent-status ${agent.status === 'active' ? 'ergon__agent-status--active' : ''}"></div>
                        </div>
                        <div class="ergon__agent-description">
                            ${agent.description || 'No description available'}
                        </div>
                        <div class="ergon__agent-actions">
                            <button class="ergon__agent-action-button" data-action="run" data-agent-id="${agent.id}" data-tekton-action="run-agent" data-tekton-action-type="primary">Run</button>
                            <button class="ergon__agent-action-button" data-action="delete" data-agent-id="${agent.id}" data-tekton-action="delete-agent" data-tekton-action-type="secondary">Delete</button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            })
            .catch(err => {
                console.error('[ERGON] Failed to load agents:', err);
                grid.innerHTML = '<div class="ergon__error-message">Failed to load agents. Please check connection.</div>';
            });
    } else {
        console.error('[ERGON] ErgonService not available');
        grid.innerHTML = '<div class="ergon__error-message">Ergon service not available.</div>';
    }
}

// Load tools from backend using ErgonService
function ergon_loadTools() {
    console.log('[ERGON] Loading tools');
    const list = document.getElementById('tools-list');
    
    // Show loading
    list.innerHTML = '<div class="ergon__loading-message"><div class="ergon__message-text">Loading tools...</div></div>';
    
    if (window.ErgonService) {
        window.ErgonService.getTools()
            .then(tools => {
                console.log('[ERGON] Tools loaded:', tools);
                list.innerHTML = ''; // Clear loading message
                
                if (tools.length === 0) {
                    list.innerHTML = '<div class="ergon__empty-message">No tools available.</div>';
                    return;
                }
                
                tools.forEach(tool => {
                    const item = document.createElement('div');
                    item.className = 'ergon__tool-item';
                    item.innerHTML = `
                        <div class="ergon__tool-name">${tool.name}</div>
                        <div class="ergon__tool-status ${tool.enabled ? 'ergon__tool-status--active' : ''}"></div>
                        <div class="ergon__tool-description">${tool.description || ''}</div>
                    `;
                    list.appendChild(item);
                });
            })
            .catch(err => {
                console.error('[ERGON] Failed to load tools:', err);
                list.innerHTML = '<div class="ergon__error-message">Failed to load tools.</div>';
            });
    } else {
        console.error('[ERGON] ErgonService not available');
        list.innerHTML = '<div class="ergon__error-message">Ergon service not available.</div>';
    }
}

// Load MCP connections from backend using ErgonService
function ergon_loadMCPConnections() {
    console.log('[ERGON] Loading MCP connections');
    const container = document.getElementById('mcp-connections');
    
    // Show loading
    container.innerHTML = '<div class="ergon__loading-message"><div class="ergon__message-text">Loading MCP connections...</div></div>';
    
    if (window.ErgonService) {
        // Load connections
        window.ErgonService.getMcpConnections()
            .then(connections => {
                console.log('[ERGON] MCP connections loaded:', connections);
                container.innerHTML = ''; // Clear loading message
                
                // Update stats
                const activeCount = connections.filter(c => c.status === 'connected').length;
                const modelCount = connections.reduce((sum, c) => sum + (c.models ? c.models.length : 0), 0);
                document.getElementById('mcp-active-count').textContent = activeCount;
                document.getElementById('mcp-models-count').textContent = modelCount;
                
                if (connections.length === 0) {
                    container.innerHTML = '<div class="ergon__empty-message">No MCP connections configured.</div>';
                    return;
                }
                
                connections.forEach(conn => {
                    const item = document.createElement('div');
                    item.className = 'ergon__mcp-connection';
                    item.innerHTML = `
                        <div class="ergon__connection-name">${conn.name}</div>
                        <div class="ergon__connection-status ${conn.status === 'connected' ? 'ergon__connection-status--active' : ''}">
                            ${conn.status === 'connected' ? 'Connected' : 'Disconnected'}
                        </div>
                        <div class="ergon__connection-models">Models: ${conn.models ? conn.models.join(', ') : 'None'}</div>
                    `;
                    container.appendChild(item);
                });
            })
            .catch(err => {
                console.error('[ERGON] Failed to load MCP connections:', err);
                container.innerHTML = '<div class="ergon__error-message">Failed to load MCP connections.</div>';
                document.getElementById('mcp-active-count').textContent = '0';
                document.getElementById('mcp-models-count').textContent = '0';
            });
        
        // Load MCP stats separately
        window.ErgonService.getMcpStats()
            .then(stats => {
                document.getElementById('mcp-token-usage').textContent = stats.token_usage || '--';
            })
            .catch(err => {
                console.error('[ERGON] Failed to load MCP stats:', err);
                document.getElementById('mcp-token-usage').textContent = '--';
            });
    } else {
        console.error('[ERGON] ErgonService not available');
        container.innerHTML = '<div class="ergon__error-message">Ergon service not available.</div>';
        document.getElementById('mcp-active-count').textContent = '0';
        document.getElementById('mcp-models-count').textContent = '0';
        document.getElementById('mcp-token-usage').textContent = '--';
    }
}

// Load memory stats using ErgonService
function ergon_loadMemoryStats() {
    console.log('[ERGON] Loading memory stats');
    
    if (window.ErgonService) {
        window.ErgonService.getMemoryStats()
            .then(stats => {
                console.log('[ERGON] Memory stats loaded:', stats);
                document.getElementById('memory-active-count').textContent = stats.active_memories || '0';
                document.getElementById('memory-storage-size').textContent = stats.total_storage || '0 MB';
                document.getElementById('memory-retention').textContent = stats.retention_period || '30 days';
            })
            .catch(err => {
                console.error('[ERGON] Failed to load memory stats:', err);
                document.getElementById('memory-active-count').textContent = '--';
                document.getElementById('memory-storage-size').textContent = '--';
                document.getElementById('memory-retention').textContent = '--';
            });
    } else {
        console.error('[ERGON] ErgonService not available');
        document.getElementById('memory-active-count').textContent = '--';
        document.getElementById('memory-storage-size').textContent = '--';
        document.getElementById('memory-retention').textContent = '--';
    }
}

// Initialize data loading
document.addEventListener('DOMContentLoaded', function() {
    // Add tab change listeners to reload data when switching tabs
    const radioButtons = document.querySelectorAll('input[name="ergon-tab"]');
    radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
            if (radio.checked) {
                const tabId = radio.id.replace('ergon-tab-', '');
                // Reload data for specific tabs
                if (tabId === 'agents') ergon_loadAgents();
                else if (tabId === 'tools') ergon_loadTools();
                else if (tabId === 'mcp') ergon_loadMCPConnections();
                else if (tabId === 'memory') ergon_loadMemoryStats();
            }
        });
    });
    
    // Load initial data
    ergon_loadData();
    
    // Add event listeners for agent creation
    const createButton = document.getElementById('create-agent-button');
    if (createButton) {
        createButton.addEventListener('click', ergon_showCreateForm);
    }
    
    const cancelButton = document.getElementById('cancel-creation');
    if (cancelButton) {
        cancelButton.addEventListener('click', ergon_hideCreateForm);
    }
    
    const submitButton = document.getElementById('submit-creation');
    if (submitButton) {
        submitButton.addEventListener('click', ergon_createAgent);
    }
    
    // Add agent action button listeners
    document.addEventListener('click', function(e) {
        if (e.target.matches('[data-action="run"]')) {
            const agentId = e.target.getAttribute('data-agent-id');
            ergon_runAgent(agentId);
        } else if (e.target.matches('[data-action="delete"]')) {
            const agentId = e.target.getAttribute('data-agent-id');
            ergon_deleteAgent(agentId);
        }
    });
});

// Show create agent form
function ergon_showCreateForm() {
    const form = document.getElementById('agent-creation-form');
    if (form) {
        form.style.display = 'flex';
    }
}

// Hide create agent form
function ergon_hideCreateForm() {
    const form = document.getElementById('agent-creation-form');
    if (form) {
        form.style.display = 'none';
        // Clear form
        document.getElementById('agent-name').value = '';
        document.getElementById('agent-type').value = 'general';
        document.getElementById('agent-description').value = '';
    }
}

// Create agent using ErgonService
function ergon_createAgent() {
    const name = document.getElementById('agent-name').value.trim();
    const type = document.getElementById('agent-type').value;
    const description = document.getElementById('agent-description').value.trim();
    
    if (!name) {
        alert('Please enter an agent name');
        return;
    }
    
    const agentData = {
        name,
        type,
        description,
        status: 'active'
    };
    
    console.log('[ERGON] Creating agent:', agentData);
    
    if (window.ErgonService) {
        window.ErgonService.createAgent(agentData)
            .then(result => {
                console.log('[ERGON] Agent created successfully:', result);
                if (result.status === 'error') {
                    alert(`Failed to create agent: ${result.message}`);
                } else {
                    ergon_hideCreateForm();
                    ergon_loadAgents(); // Reload agents
                }
            })
            .catch(err => {
                console.error('[ERGON] Failed to create agent:', err);
                alert('Failed to create agent. Please try again.');
            });
    } else {
        console.error('[ERGON] ErgonService not available');
        alert('Ergon service not available.');
    }
}

// Run agent
function ergon_runAgent(agentId) {
    const apiUrl = window.ergonUrl ? window.ergonUrl(`/api/v1/agents/${agentId}/run`) : `/api/v1/agents/${agentId}/run`;
    
    fetch(apiUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to run agent');
        return response.json();
    })
    .then(data => {
        console.log('Agent execution started:', data);
        alert(`Agent execution started. Execution ID: ${data.executionId || data.id}`);
    })
    .catch(err => {
        console.error('Failed to run agent:', err);
        alert('Failed to run agent. Please try again.');
    });
}

// Delete agent using ErgonService
function ergon_deleteAgent(agentId) {
    if (!confirm('Are you sure you want to delete this agent?')) {
        return;
    }
    
    console.log('[ERGON] Deleting agent:', agentId);
    
    if (window.ErgonService) {
        window.ErgonService.deleteAgent(agentId)
            .then(result => {
                console.log('[ERGON] Agent deleted successfully:', result);
                if (result.status === 'error') {
                    alert(`Failed to delete agent: ${result.message}`);
                } else {
                    ergon_loadAgents(); // Reload agents
                }
            })
            .catch(err => {
                console.error('[ERGON] Failed to delete agent:', err);
                alert('Failed to delete agent. Please try again.');
            });
    } else {
        console.error('[ERGON] ErgonService not available');
        alert('Ergon service not available.');
    }
}
</script>