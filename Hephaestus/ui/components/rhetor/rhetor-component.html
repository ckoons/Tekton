<!-- 
  Rhetor LLM/Prompt/Context Management Component
  This component provides a web interface for LLM management, prompt templates, context management,
  agency/alignment controls, and chat interfaces.
  
  IMPORTANT: Follows Component Implementation Standard in /MetaData/UI/ComponentImplementationStandard.md
  UPDATE: Converted to radio button pattern for reliable tab switching (like Settings component)
-->

<!-- Hidden radio controls for CSS-only tab functionality -->
<input type="radio" name="rhetor-tab" id="tab-dashboard" checked style="display: none;">
<input type="radio" name="rhetor-tab" id="tab-models" style="display: none;">
<input type="radio" name="rhetor-tab" id="tab-prompts" style="display: none;">
<input type="radio" name="rhetor-tab" id="tab-contexts" style="display: none;">
<input type="radio" name="rhetor-tab" id="tab-specialists" style="display: none;">
<input type="radio" name="rhetor-tab" id="tab-llmchat" style="display: none;">
<input type="radio" name="rhetor-tab" id="tab-teamchat" style="display: none;">
<div class="rhetor" 
     data-tekton-area="rhetor"
     data-tekton-component="rhetor"
     data-tekton-type="component-workspace"
     data-tekton-ai="rhetor-orchestrator"
     data-tekton-ai-ready="false">
  <!-- Component Header with Title -->
  <div class="rhetor__header" data-tekton-zone="header" data-tekton-section="header">
    <div class="rhetor__title-container">
      <img src="/images/hexagon.jpg" alt="Tekton" class="rhetor__icon">
      <h2 class="rhetor__title">
        <span class="rhetor__title-main">Rhetor</span>
        <span class="rhetor__title-sub">LLM/Prompt/Context</span>
      </h2>
    </div>
  </div>
  
  <!-- Tab Navigation - DIRECT ONCLICK HANDLERS -->
  <div class="rhetor__menu-bar" data-tekton-zone="menu" data-tekton-nav="component-menu">
    <div class="rhetor__tabs">
      <!-- Dashboard (new default) -->
      <label for="tab-dashboard" class="rhetor__tab" data-tab="dashboard" 
             data-tekton-menu-item="Dashboard"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="dashboard-panel">
        <span class="rhetor__tab-label">Dashboard</span>
      </label>
      <!-- Models (new) -->
      <label for="tab-models" class="rhetor__tab" data-tab="models" 
             data-tekton-menu-item="Models"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="models-panel">
        <span class="rhetor__tab-label">Models</span>
      </label>
      <!-- Prompts (new) -->
      <label for="tab-prompts" class="rhetor__tab" data-tab="prompts" 
             data-tekton-menu-item="Prompts"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="prompts-panel">
        <span class="rhetor__tab-label">Prompts</span>
      </label>
      <!-- Contexts (new) -->
      <label for="tab-contexts" class="rhetor__tab" data-tab="contexts" 
             data-tekton-menu-item="Contexts"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="contexts-panel">
        <span class="rhetor__tab-label">Contexts</span>
      </label>
      <!-- Specialists (renamed from AI Specialists) -->
      <label for="tab-specialists" class="rhetor__tab" data-tab="specialists" 
             data-tekton-menu-item="Specialists"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="specialists-panel">
        <span class="rhetor__tab-label">Specialists</span>
      </label>
      <!-- LLM Chat (moved to right) -->
      <label for="tab-llmchat" class="rhetor__tab" data-tab="llmchat" 
             data-tekton-menu-item="LLM Chat"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="llmchat-panel">
        <span class="rhetor__tab-label">LLM Chat</span>
      </label>
      <!-- Team Chat (rightmost) -->
      <label for="tab-teamchat" class="rhetor__tab" data-tab="teamchat" 
             data-tekton-menu-item="Team Chat"
             data-tekton-menu-component="rhetor"
             data-tekton-menu-panel="teamchat-panel">
        <span class="rhetor__tab-label">Team Chat</span>
      </label>
    </div>
    <div class="rhetor__actions">
      <button id="clear-chat-btn" class="rhetor__action-button" style="display: none;" onclick="rhetor_clearChat(); return false;"
              data-tekton-action="clear-chat"
              data-tekton-action-type="secondary">
        <span class="rhetor__button-label">Clear</span>
      </button>
    </div>
  </div>
  
  <!-- Content Area with Panels -->
  <div class="rhetor__content" data-tekton-zone="content" data-tekton-scrollable="true">
    <!-- Dashboard Tab (New Default) -->
    <div id="dashboard-panel" class="rhetor__panel" 
         data-tekton-panel="dashboard"
         data-tekton-panel-for="Dashboard"
         data-tekton-panel-component="rhetor">
      <div class="rhetor__dashboard">
        <!-- Component Status Grid -->
        <div class="rhetor__dashboard-section">
          <h2 class="rhetor__dashboard-title">Component Status</h2>
          <div class="rhetor__component-grid" id="component-status-grid">
            <!-- Component cards in order from left panel -->
            <div class="rhetor__component-card" data-component="tekton">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Tekton</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Projects</div>
                <div class="rhetor__metric">System OK</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="prometheus">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Prometheus</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Planning</div>
                <div class="rhetor__metric">3 strategies</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="telos">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Telos</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Requirements</div>
                <div class="rhetor__metric">12 tracked</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="ergon">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Ergon</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Agents/Tools</div>
                <div class="rhetor__metric">5 active</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="metis">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Metis</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Workflows</div>
                <div class="rhetor__metric">2 running</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="harmonia">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Harmonia</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Orchestration</div>
                <div class="rhetor__metric">Balanced</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="synthesis">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Synthesis</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Integration</div>
                <div class="rhetor__metric">All synced</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="athena">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Athena</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Knowledge</div>
                <div class="rhetor__metric">71 entities</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="sophia">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Sophia</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Learning</div>
                <div class="rhetor__metric">Adapting</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="engram">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Engram</span>
                <span class="rhetor__component-status rhetor__component-status--inactive">○</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Memory</div>
                <div class="rhetor__metric">Loading...</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="apollo">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Apollo</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Attention</div>
                <div class="rhetor__metric">2 focused</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="rhetor">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Rhetor</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">LLM/Prompt</div>
                <div class="rhetor__metric">3 models</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="penia">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Penia</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">LLM Cost</div>
                <div class="rhetor__metric">$0.42/hr</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="hermes">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Hermes</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Messages</div>
                <div class="rhetor__metric">5 clients</div>
              </div>
            </div>
            <div class="rhetor__component-card" data-component="terma">
              <div class="rhetor__component-header">
                <span class="rhetor__component-name">Terma</span>
                <span class="rhetor__component-status rhetor__component-status--active">●</span>
              </div>
              <div class="rhetor__component-metrics">
                <div class="rhetor__metric">Terminal</div>
                <div class="rhetor__metric">Ready</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Lower Section with Specialists and Token Usage -->
        <div class="rhetor__dashboard-lower">
          <!-- Active AI Specialists -->
          <div class="rhetor__dashboard-section rhetor__dashboard-section--half">
            <h3 class="rhetor__dashboard-subtitle">Active AI Specialists</h3>
            <div class="rhetor__specialist-list" id="dashboard-specialist-list">
              <div class="rhetor__specialist-item">
                <span class="rhetor__specialist-name">rhetor-orchestrator</span>
                <span class="rhetor__specialist-model">[Opus]</span>
              </div>
              <div class="rhetor__specialist-item">
                <span class="rhetor__specialist-name">apollo-coordinator</span>
                <span class="rhetor__specialist-model">[Sonnet]</span>
              </div>
              <div class="rhetor__specialist-item">
                <span class="rhetor__specialist-name">hermes-messenger</span>
                <span class="rhetor__specialist-model">[Haiku]</span>
              </div>
              <div class="rhetor__specialist-item">
                <span class="rhetor__specialist-name">athena-analyst</span>
                <span class="rhetor__specialist-model">[Sonnet]</span>
              </div>
              <div class="rhetor__specialist-item">
                <span class="rhetor__specialist-name">prometheus-strategist</span>
                <span class="rhetor__specialist-model">[Opus]</span>
              </div>
              <div class="rhetor__specialist-item">
                <span class="rhetor__specialist-name">telos-planner</span>
                <span class="rhetor__specialist-model">[Haiku]</span>
              </div>
            </div>
          </div>
          
          <!-- Token Usage -->
          <div class="rhetor__dashboard-section rhetor__dashboard-section--half">
            <h3 class="rhetor__dashboard-subtitle">Token Usage (24h)</h3>
            <div class="rhetor__token-stats" id="dashboard-token-stats">
              <div class="rhetor__token-total">
                <span class="rhetor__token-label">Total:</span>
                <span class="rhetor__token-value">1.2M tokens</span>
              </div>
              <div class="rhetor__token-cost">
                <span class="rhetor__token-label">Cost:</span>
                <span class="rhetor__token-value">$42.50</span>
              </div>
              <div class="rhetor__token-breakdown">
                <div class="rhetor__token-bar">
                  <div class="rhetor__token-segment rhetor__token-segment--opus" style="width: 45%;">
                    <span class="rhetor__token-percent">Opus 45%</span>
                  </div>
                  <div class="rhetor__token-segment rhetor__token-segment--sonnet" style="width: 30%;">
                    <span class="rhetor__token-percent">Sonnet 30%</span>
                  </div>
                  <div class="rhetor__token-segment rhetor__token-segment--haiku" style="width: 25%;">
                    <span class="rhetor__token-percent">Haiku 25%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- AI Specialists Tab (No longer default) -->
    <div id="specialists-panel" class="rhetor__panel" 
         data-tekton-panel="specialists"
         data-tekton-panel-for="Specialists"
         data-tekton-panel-component="rhetor">
      <div class="rhetor__section-header">
        <h2>AI Specialists</h2>
        <div class="rhetor__controls">
          <button class="rhetor__button rhetor__button--primary" onclick="rhetor_createSpecialist()"
                  data-tekton-action="create-specialist"
                  data-tekton-action-type="primary">Create Specialist</button>
          <button class="rhetor__button" onclick="rhetor_refreshSpecialists()"
                  data-tekton-action="refresh-specialists"
                  data-tekton-action-type="secondary">Refresh</button>
        </div>
      </div>
      
      <div class="rhetor__specialists-grid" id="specialists-grid">
        <!-- AI Specialist cards will be dynamically inserted here -->
        <div class="rhetor__loading">Loading AI specialists...</div>
      </div>
    </div>
    
    <!-- Orchestration Tab -->
    <div id="orchestration-panel" class="rhetor__panel">
      <div class="rhetor__section-header">
        <h2>Orchestration Settings</h2>
      </div>
      
      <div class="rhetor__settings-section">
        <h3>Message Routing</h3>
        <div class="rhetor__form-group">
          <label class="rhetor__form-label">Orchestration Mode</label>
          <select class="rhetor__form-select" id="orchestration-mode">
            <option value="passive">Passive Monitor</option>
            <option value="active" selected>Active Coordinator</option>
            <option value="translator">Universal Translator</option>
          </select>
        </div>
        
        <div class="rhetor__form-group">
          <label class="rhetor__form-label">Auto-Translation</label>
          <div class="rhetor__checkbox-group">
            <label class="rhetor__checkbox">
              <input type="checkbox" id="auto-translate" checked
                     data-tekton-input="auto-translate"
                     data-tekton-input-type="toggle"> Enable automatic translation between AI specialists
            </label>
          </div>
        </div>
        
        <div class="rhetor__form-group">
          <label class="rhetor__form-label">Message Filtering</label>
          <div class="rhetor__checkbox-group">
            <label class="rhetor__checkbox">
              <input type="checkbox" id="filter-redundant" checked
                     data-tekton-input="filter-redundant"
                     data-tekton-input-type="toggle"> Filter redundant messages
            </label>
            <label class="rhetor__checkbox">
              <input type="checkbox" id="filter-errors"
                     data-tekton-input="filter-errors"
                     data-tekton-input-type="toggle"> Filter error messages
            </label>
            <label class="rhetor__checkbox">
              <input type="checkbox" id="summarize-verbose"
                     data-tekton-input="summarize-verbose"
                     data-tekton-input-type="toggle"> Summarize verbose exchanges
            </label>
          </div>
        </div>
        
        <div class="rhetor__form-actions">
          <button class="rhetor__button rhetor__button--primary" onclick="rhetor_saveOrchestration()"
                  data-tekton-action="save-orchestration"
                  data-tekton-action-type="primary">Save Settings</button>
        </div>
      </div>
    </div>
    
    <!-- Active Sessions Tab -->
    <div id="sessions-panel" class="rhetor__panel">
      <div class="rhetor__section-header">
        <h2>Active AI Sessions</h2>
        <div class="rhetor__controls">
          <button class="rhetor__button rhetor__button--primary" onclick="rhetor_createSession()"
                  data-tekton-action="create-session"
                  data-tekton-action-type="primary">New Session</button>
          <button class="rhetor__button" onclick="rhetor_refreshSessions()"
                  data-tekton-action="refresh-sessions"
                  data-tekton-action-type="secondary">Refresh</button>
        </div>
      </div>
      
      <div class="rhetor__sessions-list" id="sessions-list">
        <!-- Active sessions will be dynamically inserted here -->
        <div class="rhetor__empty-state">No active AI sessions. Create a new session to begin.</div>
      </div>
    </div>
    
    <!-- Configuration Tab -->
    <div id="configuration-panel" class="rhetor__panel">
      <div class="rhetor__section-header">
        <h2>AI Configuration</h2>
      </div>
      
      <div class="rhetor__settings-section">
        <h3>Model Settings</h3>
        <div class="rhetor__form-group">
          <label class="rhetor__form-label">Anthropic Max Account</label>
          <div class="rhetor__checkbox-group">
            <label class="rhetor__checkbox">
              <input type="checkbox" id="anthropic-max" onchange="rhetor_toggleAnthropicMax()"
                     data-tekton-input="anthropic-max"
                     data-tekton-input-type="toggle"> Use Anthropic Max (Unlimited tokens for testing)
            </label>
          </div>
        </div>
        
        <h3>Default Models by Specialist Type</h3>
        <div class="rhetor__model-config">
          <div class="rhetor__form-group">
            <label class="rhetor__form-label">Orchestrator (Meta-AI)</label>
            <select class="rhetor__form-select" id="model-orchestrator">
              <option value="claude-3-opus-20240229" selected>Claude 3 Opus</option>
              <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
              <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
            </select>
          </div>
          
          <div class="rhetor__form-group">
            <label class="rhetor__form-label">Memory Specialist</label>
            <select class="rhetor__form-select" id="model-memory">
              <option value="claude-3-haiku-20240307" selected>Claude 3 Haiku</option>
              <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
            </select>
          </div>
          
          <div class="rhetor__form-group">
            <label class="rhetor__form-label">Executive Coordinator</label>
            <select class="rhetor__form-select" id="model-coordinator">
              <option value="claude-3-sonnet-20240229" selected>Claude 3 Sonnet</option>
              <option value="claude-3-opus-20240229">Claude 3 Opus</option>
            </select>
          </div>
        </div>
        
        <div class="rhetor__form-actions">
          <button class="rhetor__button rhetor__button--primary" onclick="rhetor_saveConfiguration()"
                  data-tekton-action="save-configuration"
                  data-tekton-action-type="primary">Save Configuration</button>
        </div>
      </div>
    </div>
    
    <!-- LLM Chat Tab -->
    <div id="llmchat-panel" class="rhetor__panel" data-tekton-chat="rhetor-llm" data-tekton-ai="rhetor-orchestrator" data-tekton-ai-ready="false">
      <div id="llmchat-messages" class="rhetor__chat-messages" data-tekton-element="chat-messages">
        <div class="rhetor__message rhetor__message--system">
          <div class="rhetor__message-content">
            <div class="rhetor__message-text">
              <h3 class="rhetor__message-title">Rhetor LLM Chat</h3>
              <p>You can ask questions about LLM capabilities, prompt templates, and context management. Try questions like:</p>
              <ul>
                <li>What models are currently available?</li>
                <li>How can I optimize prompts for specific tasks?</li>
                <li>What context management features are available?</li>
                <li>How can I adjust model parameters for different use cases?</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Team Chat Tab -->
    <div id="teamchat-panel" class="rhetor__panel">
      <div id="teamchat-messages" class="rhetor__chat-messages">
        <!-- Welcome message -->
        <div class="rhetor__message rhetor__message--system">
          <div class="rhetor__message-content">
            <div class="rhetor__message-text">
              <h3 class="rhetor__message-title">Tekton Team Chat</h3>
              <p>This chat is shared across all Tekton components. Use this for team communication and coordination.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Models Tab -->
    <div id="models-panel" class="rhetor__panel"
         data-tekton-panel="models"
         data-tekton-panel-for="Models"
         data-tekton-panel-component="rhetor">
      <div class="rhetor__section-header">
        <h2>Models & Providers</h2>
      </div>
      <div class="rhetor__empty-state">
        <p>Model management interface coming soon...</p>
      </div>
    </div>
    
    <!-- Prompts Tab -->
    <div id="prompts-panel" class="rhetor__panel"
         data-tekton-panel="prompts"
         data-tekton-panel-for="Prompts"
         data-tekton-panel-component="rhetor">
      <div class="rhetor__section-header">
        <h2>Prompt Engineering</h2>
      </div>
      <div class="rhetor__empty-state">
        <p>Prompt template management coming soon...</p>
      </div>
    </div>
    
    <!-- Contexts Tab -->
    <div id="contexts-panel" class="rhetor__panel"
         data-tekton-panel="contexts"
         data-tekton-panel-for="Contexts"
         data-tekton-panel-component="rhetor">
      <div class="rhetor__section-header">
        <h2>Context Management</h2>
      </div>
      <div class="rhetor__empty-state">
        <p>Context window optimization coming soon...</p>
      </div>
    </div>
  </div>
  
  <!-- Footer with Chat Input -->
  <div class="rhetor__footer" data-tekton-zone="footer" data-tekton-section="footer">
    <div class="rhetor__chat-input-container" data-tekton-chat="rhetor-llm" data-tekton-chat-component="rhetor">
      <div class="rhetor__chat-prompt">></div>
      <input type="text" class="rhetor__chat-input" id="chat-input"
             data-tekton-input="chat-input"
             data-tekton-input-type="chat"
             placeholder="Enter chat message for LLM context management, prompts, or team communication"
             onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); rhetor_sendLLMChat(); }">
      <button class="rhetor__send-button" id="send-button" onclick="rhetor_sendLLMChat(); return false;"
              data-tekton-action="send-message"
              data-tekton-action-type="primary">Send</button>
    </div>
  </div>
</div>

<!-- Add component-specific styles -->
<style>
  /* Rhetor component styles using BEM naming convention */
  
  /* CSS-Only Tab Switching using Radio Button Pattern */
  
  /* Dashboard panel - visible when dashboard radio is checked */
  #tab-dashboard:checked ~ .rhetor #dashboard-panel {
    display: block;
  }
  
  /* Models panel - visible when models radio is checked */
  #tab-models:checked ~ .rhetor #models-panel {
    display: block;
  }
  
  /* Prompts panel - visible when prompts radio is checked */
  #tab-prompts:checked ~ .rhetor #prompts-panel {
    display: block;
  }
  
  /* Contexts panel - visible when contexts radio is checked */
  #tab-contexts:checked ~ .rhetor #contexts-panel {
    display: block;
  }
  
  /* Specialists panel - visible when specialists radio is checked */
  #tab-specialists:checked ~ .rhetor #specialists-panel {
    display: block;
  }
  
  /* LLM Chat panel - visible when llmchat radio is checked */
  #tab-llmchat:checked ~ .rhetor #llmchat-panel {
    display: block;
  }
  
  /* Team Chat panel - visible when teamchat radio is checked */
  #tab-teamchat:checked ~ .rhetor #teamchat-panel {
    display: block;
  }
  
  /* Hide all panels by default */
  #tab-dashboard:not(:checked) ~ .rhetor #dashboard-panel,
  #tab-models:not(:checked) ~ .rhetor #models-panel,
  #tab-prompts:not(:checked) ~ .rhetor #prompts-panel,
  #tab-contexts:not(:checked) ~ .rhetor #contexts-panel,
  #tab-specialists:not(:checked) ~ .rhetor #specialists-panel,
  #tab-llmchat:not(:checked) ~ .rhetor #llmchat-panel,
  #tab-teamchat:not(:checked) ~ .rhetor #teamchat-panel {
    display: none;
  }
  
  /* Active tab styling */
  #tab-dashboard:checked ~ .rhetor label[for="tab-dashboard"],
  #tab-models:checked ~ .rhetor label[for="tab-models"],
  #tab-prompts:checked ~ .rhetor label[for="tab-prompts"],
  #tab-contexts:checked ~ .rhetor label[for="tab-contexts"],
  #tab-specialists:checked ~ .rhetor label[for="tab-specialists"],
  #tab-llmchat:checked ~ .rhetor label[for="tab-llmchat"],
  #tab-teamchat:checked ~ .rhetor label[for="tab-teamchat"] {
    border-bottom-color: var(--color-primary, #673AB7);
    font-weight: 500;
  }
  
  /* Show/hide clear button based on chat tabs */
  #tab-llmchat:checked ~ .rhetor #clear-chat-btn,
  #tab-teamchat:checked ~ .rhetor #clear-chat-btn {
    display: block !important;
  }
  
  #tab-dashboard:checked ~ .rhetor #clear-chat-btn,
  #tab-models:checked ~ .rhetor #clear-chat-btn,
  #tab-prompts:checked ~ .rhetor #clear-chat-btn,
  #tab-contexts:checked ~ .rhetor #clear-chat-btn,
  #tab-specialists:checked ~ .rhetor #clear-chat-btn {
    display: none !important;
  }
  
  /* Container */
  .rhetor {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    background-color: var(--bg-primary, #1e1e2e);
    color: var(--text-primary, #f0f0f0);
    /* No absolute positioning - proper component containment */
  }
  
  /* Header */
  .rhetor__header {
    display: flex;
    align-items: center;
    padding: 10px 16px;
    background-color: var(--bg-secondary, #252535);
    border-bottom: 1px solid var(--border-color, #444444);
  }
  
  .rhetor__title-container {
    display: flex;
    align-items: center;
  }
  
  .rhetor__icon {
    height: 30px;
    width: auto;
    margin-right: 12px;
  }
  
  .rhetor__title {
    margin: 0;
    font-size: 1.2rem;
    font-weight: 500;
  }
  
  .rhetor__title-sub {
    margin-left: 8px;
    opacity: 0.8;
    font-weight: normal;
  }
  
  /* Menu Bar */
  .rhetor__menu-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 16px;
    background-color: var(--bg-secondary, #252535);
    border-bottom: 1px solid var(--border-color, #444444);
    height: 46px; /* Match standard control bar height */
  }
  
  .rhetor__tabs {
    display: flex;
    gap: 8px;
  }
  
  .rhetor__tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background-color: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--text-primary, #f0f0f0);
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .rhetor__tab:hover {
    background-color: var(--bg-hover, #3a3a4a);
  }
  
  /* Active tab styling now handled by CSS :checked selectors
  .rhetor__tab--active {
    border-bottom-color: var(--color-primary, #673AB7);
    font-weight: 500;
  }
  
  /* Actions */
  .rhetor__actions {
    display: flex;
    gap: 8px;
  }
  
  .rhetor__action-button {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background-color: var(--bg-tertiary, #333345);
    border: 1px solid var(--border-color, #444444);
    border-radius: 4px;
    color: var(--text-primary, #f0f0f0);
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .rhetor__action-button:hover {
    background-color: var(--bg-hover, #3a3a4a);
  }
  
  /* Content Area */
  .rhetor__content {
    flex: 1;
    overflow: hidden;
    position: relative;
  }
  
  .rhetor__panel {
    display: none; /* Hidden by default, CSS :checked selectors will show */
    height: 100%;
    width: 100%;
    overflow: auto;
    padding: 16px;
  }
  
  /* Section Headers */
  .rhetor__section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }
  
  .rhetor__section-header h2 {
    margin: 0;
    color: var(--text-primary, #f0f0f0);
    font-size: 1.25rem;
  }
  
  .rhetor__controls {
    display: flex;
    gap: 8px;
  }
  
  /* Form Elements */
  .rhetor__form-group {
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
  }
  
  .rhetor__form-label {
    margin-bottom: 4px;
    color: var(--text-secondary, #aaaaaa);
    font-weight: 500;
  }
  
  .rhetor__form-select,
  .rhetor__form-input,
  .rhetor__form-textarea {
    padding: 8px;
    border: 1px solid var(--border-color, #444444);
    border-radius: 4px;
    background-color: var(--bg-tertiary, #333345);
    color: var(--text-primary, #f0f0f0);
    font-size: 1rem;
    outline: none;
  }
  
  .rhetor__form-select:focus,
  .rhetor__form-input:focus,
  .rhetor__form-textarea:focus {
    border-color: var(--color-primary, #673AB7);
    box-shadow: 0 0 0 2px rgba(103, 58, 183, 0.2);
  }
  
  .rhetor__form-textarea {
    min-height: 200px;
    resize: vertical;
  }
  
  .rhetor__slider-container {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  
  .rhetor__form-slider {
    flex: 1;
  }
  
  .rhetor__slider-value {
    font-family: monospace;
    color: var(--text-secondary, #aaaaaa);
    min-width: 3ch;
    text-align: right;
  }
  
  .rhetor__form-actions {
    display: flex;
    gap: 8px;
    margin-top: 24px;
    justify-content: flex-end;
  }
  
  /* Buttons */
  .rhetor__button {
    padding: 8px 16px;
    border: 1px solid var(--border-color, #444444);
    border-radius: 4px;
    background-color: var(--bg-tertiary, #333345);
    color: var(--text-secondary, #aaaaaa);
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    outline: none;
  }
  
  .rhetor__button:hover {
    background-color: var(--bg-hover, #3a3a4a);
    color: var(--text-primary, #f0f0f0);
  }
  
  .rhetor__button--primary {
    background-color: var(--color-primary, #673AB7);
    border-color: var(--color-primary, #673AB7);
    color: white;
  }
  
  .rhetor__button--primary:hover {
    background-color: var(--color-primary-hover, #5E35B1);
    color: white;
  }
  
  /* Template List */
  .rhetor__template-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  
  .rhetor__template-item {
    background-color: var(--bg-tertiary, #333345);
    border: 1px solid var(--border-color, #444444);
    border-radius: 8px;
    padding: 16px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }
  
  .rhetor__template-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  .rhetor__template-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }
  
  .rhetor__template-item-name {
    font-weight: 600;
    color: var(--text-primary, #f0f0f0);
  }
  
  .rhetor__template-item-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    color: white;
    font-weight: 500;
  }
  
  .rhetor__template-item-badge--system {
    background-color: #17a2b8;
  }
  
  .rhetor__template-item-badge--task {
    background-color: #28a745;
  }
  
  .rhetor__template-item-description {
    color: var(--text-secondary, #aaaaaa);
    margin-bottom: 16px;
    font-size: 1rem;
    line-height: 1.4;
  }
  
  .rhetor__template-item-footer {
    display: flex;
    gap: 4px;
  }
  
  .rhetor__template-item-button {
    padding: 4px 8px;
    border: 1px solid var(--border-color, #444444);
    border-radius: 4px;
    background-color: var(--bg-secondary, #252535);
    color: var(--text-secondary, #aaaaaa);
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .rhetor__template-item-button:hover {
    background-color: var(--bg-hover, #3a3a4a);
    color: var(--text-primary, #f0f0f0);
  }
  
  /* Settings Section */
  .rhetor__settings-section {
    background-color: var(--bg-tertiary, #333345);
    border: 1px solid var(--border-color, #444444);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 24px;
  }
  
  .rhetor__settings-section h3 {
    margin-top: 0;
    margin-bottom: 16px;
    color: var(--text-primary, #f0f0f0);
    border-bottom: 1px solid var(--border-color, #444444);
    padding-bottom: 4px;
  }
  
  /* Chat Panels */
  #llmchat-panel, #teamchat-panel {
    position: relative; /* Needed for footer positioning */
    overflow: hidden; /* Prevent double scrollbars */
  }
  
  /* Chat Messages */
  .rhetor__chat-messages {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 70px; /* Height of the footer */
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .rhetor__message {
    border-radius: 16px;
    padding: 12px 16px;
    max-width: 85%;
    word-wrap: break-word;
    line-height: 1.4;
  }
  
  .rhetor__message--system {
    background-color: var(--bg-tertiary, #333345);
    align-self: center;
    max-width: 90%;
    width: 600px;
    margin: 8px 0;
    border-radius: 8px;
    padding: 16px 24px;
  }
  
  .rhetor__message--user {
    background-color: var(--color-primary, #673AB7);
    color: white;
    align-self: flex-end;
    border-radius: 16px 16px 0 16px;
  }
  
  .rhetor__message--ai {
    background-color: var(--bg-secondary, #252535);
    align-self: flex-start;
    border-radius: 16px 16px 16px 0;
  }
  
  /* Footer with Chat Input */
  .rhetor__footer {
    background-color: var(--bg-secondary, #252535);
    border-top: 1px solid var(--border-color, #444444);
    padding: 12px 16px;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 70px; /* Fixed height to match bottom value in chat messages */
  }
  
  .rhetor__chat-input-container {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
  }
  
  .rhetor__chat-prompt {
    font-size: 18px;
    font-weight: bold;
    color: #4CAF50;
  }
  
  .rhetor__chat-input {
    flex: 1;
    height: 44px;
    padding: 8px 16px;
    background-color: var(--bg-tertiary, #333345);
    border: 1px solid var(--border-color, #444444);
    border-radius: 8px;
    color: var(--text-primary, #f0f0f0);
    font-size: 14px;
  }
  
  .rhetor__send-button {
    height: 44px;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-primary, #673AB7);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .rhetor__send-button:hover {
    background-color: var(--color-primary-hover, #5E35B1);
  }
  
  /* AI Specialists Grid */
  .rhetor__specialists-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    padding: 16px 0;
  }
  
  .rhetor__specialist-card {
    background-color: var(--bg-tertiary, #333345);
    border: 1px solid var(--border-color, #444444);
    border-radius: 8px;
    padding: 16px;
    transition: all 0.2s ease;
    position: relative;
  }
  
  .rhetor__specialist-card--active {
    border-color: var(--color-primary, #673AB7);
    box-shadow: 0 0 0 1px var(--color-primary, #673AB7);
  }
  
  .rhetor__specialist-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }
  
  .rhetor__specialist-status {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: var(--bg-secondary, #252535);
    border: 2px solid var(--border-color, #444444);
  }
  
  .rhetor__specialist-status--active {
    background-color: #28a745;
    border-color: #28a745;
    box-shadow: 0 0 4px #28a745;
  }
  
  .rhetor__specialist-status--processing {
    background-color: #ffc107;
    border-color: #ffc107;
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }
  
  .rhetor__specialist-header {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
  }
  
  .rhetor__specialist-icon {
    font-size: 32px;
    margin-right: 12px;
  }
  
  .rhetor__specialist-info {
    flex: 1;
  }
  
  .rhetor__specialist-name {
    font-weight: 600;
    color: var(--text-primary, #f0f0f0);
    margin: 0;
    font-size: 1.1rem;
  }
  
  .rhetor__specialist-type {
    color: var(--text-secondary, #aaaaaa);
    font-size: 0.85rem;
  }
  
  .rhetor__specialist-stats {
    display: flex;
    gap: 16px;
    margin: 12px 0;
    padding: 8px 0;
    border-top: 1px solid var(--border-color, #444444);
    border-bottom: 1px solid var(--border-color, #444444);
  }
  
  .rhetor__specialist-stat {
    flex: 1;
    text-align: center;
  }
  
  .rhetor__specialist-stat-value {
    display: block;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-primary, #f0f0f0);
  }
  
  .rhetor__specialist-stat-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary, #aaaaaa);
    margin-top: 2px;
  }
  
  .rhetor__specialist-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
  }
  
  .rhetor__specialist-action {
    flex: 1;
    padding: 6px 12px;
    border: 1px solid var(--border-color, #444444);
    border-radius: 4px;
    background-color: var(--bg-secondary, #252535);
    color: var(--text-secondary, #aaaaaa);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
  }
  
  .rhetor__specialist-action:hover {
    background-color: var(--bg-hover, #3a3a4a);
    color: var(--text-primary, #f0f0f0);
  }
  
  .rhetor__specialist-action--primary {
    background-color: var(--color-primary, #673AB7);
    border-color: var(--color-primary, #673AB7);
    color: white;
  }
  
  .rhetor__specialist-action--primary:hover {
    background-color: var(--color-primary-hover, #5E35B1);
  }
  
  /* Active Sessions */
  .rhetor__sessions-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 16px 0;
  }
  
  .rhetor__session-item {
    background-color: var(--bg-tertiary, #333345);
    border: 1px solid var(--border-color, #444444);
    border-radius: 8px;
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 16px;
    transition: all 0.2s ease;
  }
  
  .rhetor__session-item:hover {
    background-color: var(--bg-hover, #3a3a4a);
  }
  
  .rhetor__session-participants {
    display: flex;
    gap: -8px;
  }
  
  .rhetor__session-participant {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: var(--bg-secondary, #252535);
    border: 2px solid var(--bg-tertiary, #333345);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    position: relative;
    z-index: 1;
  }
  
  .rhetor__session-info {
    flex: 1;
  }
  
  .rhetor__session-title {
    font-weight: 600;
    color: var(--text-primary, #f0f0f0);
    margin: 0 0 4px 0;
  }
  
  .rhetor__session-meta {
    font-size: 0.85rem;
    color: var(--text-secondary, #aaaaaa);
  }
  
  .rhetor__session-actions {
    display: flex;
    gap: 8px;
  }
  
  .rhetor__session-action {
    padding: 6px 12px;
    border: 1px solid var(--border-color, #444444);
    border-radius: 4px;
    background-color: var(--bg-secondary, #252535);
    color: var(--text-secondary, #aaaaaa);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .rhetor__session-action:hover {
    background-color: var(--bg-hover, #3a3a4a);
    color: var(--text-primary, #f0f0f0);
  }
  
  /* Loading and Empty States */
  .rhetor__loading {
    text-align: center;
    padding: 48px;
    color: var(--text-secondary, #aaaaaa);
  }
  
  .rhetor__empty-state {
    text-align: center;
    padding: 48px;
    color: var(--text-secondary, #aaaaaa);
    background-color: var(--bg-tertiary, #333345);
    border: 1px dashed var(--border-color, #444444);
    border-radius: 8px;
  }
  
  /* Model Configuration */
  .rhetor__model-config {
    display: grid;
    gap: 16px;
    margin-top: 16px;
  }
  
  /* Typing indicator */
  .rhetor__typing-indicator .rhetor__message-text {
    display: flex;
    gap: 4px;
    padding: 8px 12px;
  }
  
  .typing-dot {
    width: 8px;
    height: 8px;
    background-color: var(--text-secondary, #aaaaaa);
    border-radius: 50%;
    animation: typing 1.4s infinite;
  }
  
  .typing-dot:nth-child(2) {
    animation-delay: 0.2s;
  }
  
  .typing-dot:nth-child(3) {
    animation-delay: 0.4s;
  }
  
  @keyframes typing {
    0%, 60%, 100% {
      opacity: 0.3;
      transform: translateY(0);
    }
    30% {
      opacity: 1;
      transform: translateY(-10px);
    }
  }
  
  /* AI message sender name */
  .rhetor__message-sender {
    font-size: 0.85rem;
    color: var(--color-primary, #673AB7);
    margin-bottom: 4px;
    font-weight: 500;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .rhetor__template-list {
      grid-template-columns: 1fr;
    }
    
    .rhetor__specialists-grid {
      grid-template-columns: 1fr;
    }
    
    .rhetor__tabs {
      overflow-x: auto;
      white-space: nowrap;
    }
  }
</style>

<!-- Self-contained component script with no shared dependencies -->
<script type="text/javascript">
// SIMPLIFIED COMPONENT SCRIPT - FULLY SELF-CONTAINED
// This prevents interference with other components

// IMMEDIATELY SET UP UI MANAGER PROTECTION
// Tell UI Manager to ignore this component - must be done IMMEDIATELY to avoid races
if (window.uiManager) {
    window.uiManager._ignoreComponent = 'rhetor';
    console.log('[RHETOR] Set UI Manager to ignore rhetor component');
}

// TAB SWITCHING NOW HANDLED BY CSS - NO JS NEEDED
// The radio button pattern handles all tab switching through CSS :checked selectors

// SEND LLM CHAT FUNCTION
window.rhetor_sendLLMChat = function() {
    console.log('[RHETOR] Send LLM chat clicked');
    
    const chatInput = document.getElementById('chat-input');
    if (!chatInput) return;
    
    const message = chatInput.value.trim();
    if (!message) return;
    
    // Check which radio button is checked to determine active tab
    const checkedRadio = document.querySelector('input[name="rhetor-tab"]:checked');
    if (!checkedRadio) return;
    
    const tabId = checkedRadio.id.replace('tab-', '');
    console.log('[RHETOR] Active tab:', tabId, 'Message:', message);
    
    // Only process for llmchat tab
    if (tabId === 'llmchat') {
        // Clear input
        chatInput.value = '';
        
        // Add user message to chat
        const chatContainer = document.getElementById('llmchat-messages');
        if (chatContainer) {
            const userMsg = document.createElement('div');
            userMsg.className = 'rhetor__message rhetor__message--user';
            userMsg.innerHTML = '<div class="rhetor__message-content"><div class="rhetor__message-text">' + 
                              message.replace(/</g, '&lt;').replace(/>/g, '&gt;') + 
                              '</div></div>';
            chatContainer.appendChild(userMsg);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Send to AI
            fetch('/api/ai/specialists/rhetor-orchestrator/message', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    message: message,
                    context_id: 'rhetor-llm-chat',
                    streaming: false
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('[RHETOR] AI response:', data);
                const aiMsg = document.createElement('div');
                aiMsg.className = 'rhetor__message rhetor__message--ai';
                aiMsg.innerHTML = '<div class="rhetor__message-content"><div class="rhetor__message-text">' + 
                                (data.response || data.message || 'No response').replace(/</g, '&lt;').replace(/>/g, '&gt;') + 
                                '</div></div>';
                chatContainer.appendChild(aiMsg);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            })
            .catch(err => {
                console.error('[RHETOR] Error:', err);
                const errorMsg = document.createElement('div');
                errorMsg.className = 'rhetor__message rhetor__message--system';
                errorMsg.innerHTML = '<div class="rhetor__message-content"><div class="rhetor__message-text" style="color:#ff6b6b;">Error: ' + 
                                   err.message + '</div></div>';
                chatContainer.appendChild(errorMsg);
            });
        }
    }
    
    return false;
};

// CHAT CLEARING FUNCTION
window.rhetor_clearChat = function() {
    console.log('[RHETOR] Clear chat clicked');
    
    try {
        // Get active tab ID using radio button
        const checkedRadio = document.querySelector('input[name="rhetor-tab"]:checked');
        if (!checkedRadio) {
            console.error('[RHETOR] Clear Chat: No tab selected');
            return false;
        }
        
        const tabId = checkedRadio.id.replace('tab-', '');
        const rhetorContainer = document.querySelector('.rhetor');
        
        if (tabId === 'llmchat' || tabId === 'teamchat') {
            // Get message container within rhetor container only
            const panel = rhetorContainer.querySelector('#' + tabId + '-messages');
            if (panel) {
                // Keep welcome message
                const welcomeMsg = panel.querySelector('.rhetor__message--system');
                if (welcomeMsg) {
                    panel.innerHTML = '';
                    panel.appendChild(welcomeMsg);
                    console.log('[RHETOR] Cleared chat, kept welcome message');
                } else {
                    panel.innerHTML = '';
                    console.log('[RHETOR] Cleared chat completely');
                }
            }
        }
    } catch (err) {
        console.error('[RHETOR] Error clearing chat:', err);
    }
    
    return false; // Stop event propagation
};

// AI ORCHESTRATION FUNCTIONS
window.rhetor_refreshSpecialists = function() {
    console.log('[RHETOR] Refreshing AI specialists');
    if (window.rhetorComponent && window.rhetorComponent.refreshSpecialists) {
        window.rhetorComponent.refreshSpecialists();
    }
    return false;
};

window.rhetor_createSpecialist = function() {
    console.log('[RHETOR] Creating new AI specialist');
    if (window.rhetorComponent && window.rhetorComponent.createSpecialist) {
        window.rhetorComponent.createSpecialist();
    }
    return false;
};

window.rhetor_saveOrchestration = function() {
    console.log('[RHETOR] Saving orchestration settings');
    if (window.rhetorComponent && window.rhetorComponent.saveOrchestration) {
        window.rhetorComponent.saveOrchestration();
    }
    return false;
};

window.rhetor_refreshSessions = function() {
    console.log('[RHETOR] Refreshing active sessions');
    if (window.rhetorComponent && window.rhetorComponent.refreshSessions) {
        window.rhetorComponent.refreshSessions();
    }
    return false;
};

window.rhetor_createSession = function() {
    console.log('[RHETOR] Creating new AI session');
    if (window.rhetorComponent && window.rhetorComponent.createSession) {
        window.rhetorComponent.createSession();
    }
    return false;
};

window.rhetor_toggleAnthropicMax = function() {
    console.log('[RHETOR] Toggling Anthropic Max');
    if (window.rhetorComponent && window.rhetorComponent.toggleAnthropicMax) {
        window.rhetorComponent.toggleAnthropicMax();
    }
    return false;
};

window.rhetor_saveConfiguration = function() {
    console.log('[RHETOR] Saving AI configuration');
    if (window.rhetorComponent && window.rhetorComponent.saveConfiguration) {
        window.rhetorComponent.saveConfiguration();
    }
    return false;
};

// LOAD COMPONENT
// Load after defining tab switching to ensure it's available
function rhetor_loadComponent() {
    console.log('[RHETOR] Loading component script...');
    
    const timestamp = new Date().getTime();
    const scriptPath = `/scripts/rhetor/rhetor-component.js?t=${timestamp}`;
    
    const script = document.createElement('script');
    script.src = scriptPath;
    script.async = false;
    script.onload = function() {
        console.log('[RHETOR] Component script loaded successfully');
        
        if (window.rhetorComponent && typeof window.rhetorComponent.init === 'function') {
            try {
                window.rhetorComponent.init();
                console.log('[RHETOR] Component initialized');
            } catch (err) {
                console.error('[RHETOR] Component initialization error:', err);
            }
        } else {
            console.warn('[RHETOR] Component init function not found');
        }
    };
    script.onerror = function() {
        console.error('[RHETOR] Failed to load component script');
    };
    
    document.body.appendChild(script);
}

// HTML PANEL PROTECTION
// Setup explicit protection for the HTML panel to prevent it being hidden
function rhetor_protectHtmlPanel() {
    const htmlPanel = document.getElementById('html-panel');
    if (!htmlPanel) {
        console.error('[RHETOR] Cannot find HTML panel to protect');
        return;
    }
    
    console.log('[RHETOR] Protecting HTML panel from being hidden');
    htmlPanel.style.display = 'block'; // Force it to be visible
    
    // Store the original display value
    if (!htmlPanel.hasOwnProperty('_rhetorOriginalDisplay')) {
        Object.defineProperty(htmlPanel, '_rhetorOriginalDisplay', {
            value: 'block',
            writable: true,
            configurable: true
        });
    }
    
    // Only define the getter/setter if it hasn't already been defined by this component
    if (!htmlPanel.style._rhetorProtected) {
        // Mark the display property as protected by this component
        Object.defineProperty(htmlPanel.style, '_rhetorProtected', {
            value: true,
            writable: false,
            configurable: true
        });
        
        // Protect the display property
        Object.defineProperty(htmlPanel.style, 'display', {
            get: function() { 
                return htmlPanel._rhetorOriginalDisplay; 
            },
            set: function(value) {
                console.log(`[RHETOR] Intercepted attempt to set HTML panel display to: ${value}`);
                if (value === 'none') {
                    console.log('[RHETOR] Blocked attempt to hide HTML panel');
                    htmlPanel._rhetorOriginalDisplay = 'block';
                } else {
                    htmlPanel._rhetorOriginalDisplay = value;
                }
            },
            configurable: true
        });
    }
}

// NAVIGATION FIX
// Ensure HTML panel is visible when component loads
function rhetor_ensurePanelVisibility() {
    console.log('[RHETOR] Ensuring HTML panel visibility');
    
    const htmlPanel = document.getElementById('html-panel');
    const terminalPanel = document.getElementById('terminal-panel');
    
    if (htmlPanel) {
        htmlPanel.style.display = 'block';
        htmlPanel.classList.add('active');
        console.log('[RHETOR] HTML panel made visible');
    }
    
    if (terminalPanel) {
        terminalPanel.style.display = 'none';
        terminalPanel.classList.remove('active');
        console.log('[RHETOR] Terminal panel hidden');
    }
    
    // Update UI manager state if available
    if (window.uiManager) {
        window.uiManager.activePanel = 'html';
        console.log('[RHETOR] Updated uiManager panel state');
    }
    
    // Report component loaded to DevTools
    window.postMessage({
        type: 'component-loaded',
        component: 'rhetor',
        timestamp: Date.now()
    }, '*');
}

// SETUP
// Do immediate initialization on script load
rhetor_ensurePanelVisibility();  // Fix navigation issue first
rhetor_protectHtmlPanel();
rhetor_loadComponent();
</script>