<!-- Synthesis Component - Execution & Integration Engine -->

<!-- Load chat dependencies -->
<script src="/scripts/shared/ai-chat.js"></script>
<script src="/scripts/tekton-urls.js"></script>
<script src="/scripts/shared/single-chat.js"></script>
<script src="/scripts/shared/team-chat.js"></script>

<!-- @landmark Synthesis Component Root -->
<div class="synthesis" data-tekton-area="synthesis" data-tekton-component="synthesis" data-tekton-type="component-workspace" data-tekton-ai="synthesis-assistant" data-tekton-ai-ready="false">
    <!-- @landmark Header Section -->
    <!-- Component Header with Title -->
    <div class="synthesis__header" data-tekton-zone="header" data-tekton-section="header">
        <div class="synthesis__title-container">
            <img src="/images/hexagon.jpg" alt="Tekton" class="synthesis__icon">
            <h2 class="synthesis__title">
                <span class="synthesis__title-main">Synthesis</span>
                <span class="synthesis__title-sub">Validation Engine</span>
            </h2>
        </div>
    </div>
    
    <!-- @landmark Navigation Menu -->
    <!-- Synthesis Menu Bar with Tab Navigation -->
    <div class="synthesis__menu-bar" data-tekton-zone="menu" data-tekton-nav="component-menu">
        <div class="synthesis__tabs" data-tekton-zone="menu">
            <div class="synthesis__tab synthesis__tab--active" data-tab="dashboard" onclick="synthesis_switchTab('dashboard'); return false;" data-tekton-menu-item="Dashboard" data-tekton-menu-component="synthesis" data-tekton-menu-active="true" data-tekton-menu-panel="dashboard-panel" data-tekton-nav-target="dashboard-panel">
                <span class="synthesis__tab-label">Dashboard</span>
            </div>
            <div class="synthesis__tab" data-tab="validation" onclick="synthesis_switchTab('validation'); return false;" data-tekton-menu-item="Validation" data-tekton-menu-component="synthesis" data-tekton-menu-active="false" data-tekton-menu-panel="validation-panel" data-tekton-nav-target="validation-panel">
                <span class="synthesis__tab-label">Validation</span>
            </div>
            <div class="synthesis__tab" data-tab="results" onclick="synthesis_switchTab('results'); return false;" data-tekton-menu-item="Results" data-tekton-menu-component="synthesis" data-tekton-menu-active="false" data-tekton-menu-panel="results-panel" data-tekton-nav-target="results-panel">
                <span class="synthesis__tab-label">Results</span>
            </div>
            <div class="synthesis__tab" data-tab="integration" onclick="synthesis_switchTab('integration'); return false;" data-tekton-menu-item="Integration" data-tekton-menu-component="synthesis" data-tekton-menu-active="false" data-tekton-menu-panel="integration-panel" data-tekton-nav-target="integration-panel">
                <span class="synthesis__tab-label">Integration</span>
            </div>
            <div class="synthesis__tab" data-tab="review" onclick="synthesis_switchTab('review'); return false;" data-tekton-menu-item="Review" data-tekton-menu-component="synthesis" data-tekton-menu-active="false" data-tekton-menu-panel="review-panel" data-tekton-nav-target="review-panel">
                <span class="synthesis__tab-label">Review</span>
            </div>
            <div class="synthesis__tab" data-tekton-chat="tab" data-tab="workflowchat" onclick="synthesis_switchTab('workflowchat'); return false;" data-tekton-menu-item="Workflow Chat" data-tekton-menu-component="synthesis" data-tekton-menu-active="false" data-tekton-menu-panel="workflowchat-panel" data-tekton-nav-target="workflowchat-panel">
                <span class="synthesis__tab-label">Workflow Chat</span>
            </div>
            <div class="synthesis__tab" data-tekton-chat="tab" data-tab="teamchat" onclick="synthesis_switchTab('teamchat'); return false;" data-tekton-menu-item="Team Chat" data-tekton-menu-component="synthesis" data-tekton-menu-active="false" data-tekton-menu-panel="teamchat-panel" data-tekton-nav-target="teamchat-panel">
                <span class="synthesis__tab-label">Team Chat</span>
            </div>
        </div>
        <div class="synthesis__actions">
            <button id="validate-sprint-btn" class="synthesis__action-button synthesis__button--validate" style="display: none;" onclick="validateCurrentSprint(); return false;" data-tekton-action="validate-sprint" data-tekton-action-type="primary">
                <span class="synthesis__button-label">Validate Sprint</span>
            </button>
            <!-- Clear button removed per request -->
        </div>
    </div>
    
    <!-- @landmark Main Content Area -->
    <!-- Synthesis Content Area -->
    <div class="synthesis__content" data-tekton-zone="content" data-tekton-scrollable="true">
        <!-- @landmark Dashboard Panel -->
        <!-- Dashboard Panel (Default Active Panel) -->
        <div id="dashboard-panel" class="synthesis__panel synthesis__panel--active" data-tekton-panel="dashboard" data-tekton-panel-for="Dashboard" data-tekton-panel-component="synthesis" data-tekton-panel-active="true">
            <div class="synthesis__dashboard" data-tekton-functionality="sprint-cards">
                <h3 class="synthesis__section-title">Ready for Validation</h3>
                <p class="synthesis__text">Sprints with status "Ready-3:Synthesis" requiring validation testing and review.</p>
                
                <div class="synthesis__sprint-grid" id="sprint-grid" data-tekton-list="sprint-cards" data-tekton-list-type="grid" data-tekton-list-empty="no-sprints">
                    <!-- Sprint cards will be populated here by scanning DAILY_LOG.md files -->
                    <!-- Currently no sprints in Ready-3:Synthesis status -->
                </div>
                
                <div class="synthesis__empty-state" id="no-sprints" data-tekton-empty-state="sprint-grid" data-tekton-state-type="info">
                    <div class="synthesis__empty-icon">ðŸ”¬</div>
                    <h4 class="synthesis__empty-title">No Sprints Ready for Validation</h4>
                    <p class="synthesis__empty-text">No sprints with status "Ready-3:Synthesis" found. Sprints will appear here when Harmonia completes workflow orchestration.</p>
                </div>
            </div>
        </div>
        
        <!-- @landmark Validation Panel -->
        <!-- Validation Panel -->
        <div id="validation-panel" class="synthesis__panel" data-tekton-panel="validation" data-tekton-panel-for="Validation" data-tekton-panel-component="synthesis" data-tekton-panel-active="false">
            <div class="synthesis__validation" data-tekton-functionality="dry-run-testing">
                <h3 class="synthesis__section-title">Workflow Validation</h3>
                <p class="synthesis__text">Dry-run testing interface with step-by-step execution and checkpoint system.</p>
                
                <div class="synthesis__validation-controls" data-tekton-form="validation-controls" data-tekton-form-type="interactive">
                    <div class="synthesis__control-group" data-tekton-field="sprint-selection">
                        <label class="synthesis__control-label">Selected Sprint:</label>
                        <select id="validation-sprint-select" class="synthesis__select" data-tekton-select="sprint">
                            <option value="">Select sprint to validate...</option>
                        </select>
                    </div>
                    <div class="synthesis__control-group" data-tekton-field="validation-mode">
                        <label class="synthesis__control-label">Validation Mode:</label>
                        <div class="synthesis__radio-group">
                            <input type="radio" id="dry-run" name="validation-mode" value="dry-run" checked data-tekton-input="mode">
                            <label for="dry-run" class="synthesis__radio-label">Dry Run (Safe)</label>
                            <input type="radio" id="live-run" name="validation-mode" value="live-run" data-tekton-input="mode">
                            <label for="live-run" class="synthesis__radio-label">Live Execution</label>
                        </div>
                    </div>
                </div>
                
                <div class="synthesis__validation-progress" id="validation-progress" style="display: none;" data-tekton-progress="validation" data-tekton-progress-type="stepped" data-tekton-progress-state="inactive">
                    <div class="synthesis__progress-header" data-tekton-header="progress">
                        <h4 class="synthesis__progress-title">Validation Progress</h4>
                        <button class="synthesis__button synthesis__button--secondary" onclick="rollbackValidation()" data-tekton-action="rollback">Rollback</button>
                    </div>
                    <div class="synthesis__steps-container" data-tekton-container="steps" data-tekton-container-type="dynamic">
                        <!-- Validation steps will be populated here -->
                    </div>
                </div>
                
                <div class="synthesis__validation-actions">
                    <button id="start-validation-btn" class="synthesis__button synthesis__button--validate" onclick="startValidation()" data-tekton-action="start-validation" data-tekton-action-type="primary">
                        <span class="synthesis__button-label">Start Validation</span>
                    </button>
                    <button id="stop-validation-btn" class="synthesis__button synthesis__button--secondary" onclick="stopValidation()" data-tekton-action="stop-validation" style="display: none;">
                        <span class="synthesis__button-label">Stop Validation</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- @landmark Results Panel -->
        <!-- Results Panel -->
        <div id="results-panel" class="synthesis__panel" data-tekton-panel="results" data-tekton-panel-for="Results" data-tekton-panel-component="synthesis" data-tekton-panel-active="false">
            <div class="synthesis__results" data-tekton-functionality="validation-reports">
                <h3 class="synthesis__section-title">Validation Results</h3>
                <p class="synthesis__text">Detailed validation reports with pass/fail status and warnings.</p>
                
                <div class="synthesis__results-filter" data-tekton-filter="results" data-tekton-filter-type="multi-select">
                    <div class="synthesis__filter-group" data-tekton-filter-group="sprint">
                        <label class="synthesis__filter-label">Sprint:</label>
                        <select id="results-sprint-filter" class="synthesis__select" data-tekton-select="filter">
                            <option value="all">All Sprints</option>
                        </select>
                    </div>
                    <div class="synthesis__filter-group" data-tekton-filter-group="status">
                        <label class="synthesis__filter-label">Status:</label>
                        <select id="results-status-filter" class="synthesis__select" data-tekton-select="filter">
                            <option value="all">All Results</option>
                            <option value="passed">Passed</option>
                            <option value="failed">Failed</option>
                            <option value="warning">With Warnings</option>
                        </select>
                    </div>
                    <div class="synthesis__filter-group" data-tekton-filter-group="date">
                        <label class="synthesis__filter-label">Date:</label>
                        <select id="results-date-filter" class="synthesis__select" data-tekton-select="filter">
                            <option value="today">Today</option>
                            <option value="week">Last Week</option>
                            <option value="month">Last Month</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>
                
                <div class="synthesis__results-container">
                    <div class="synthesis__results-table-container">
                        <table class="synthesis__table synthesis__results-table" data-tekton-table="validation-results" data-tekton-table-type="report" data-tekton-sortable="true">
                            <thead data-tekton-table-header="true">
                                <tr data-tekton-row="header">
                                    <th data-tekton-column="sprint" data-tekton-sortable="true">Sprint</th>
                                    <th data-tekton-column="date" data-tekton-sortable="true">Validation Date</th>
                                    <th data-tekton-column="duration" data-tekton-sortable="true">Duration</th>
                                    <th data-tekton-column="steps" data-tekton-sortable="true">Steps</th>
                                    <th data-tekton-column="status" data-tekton-sortable="true">Status</th>
                                    <th data-tekton-column="coverage" data-tekton-sortable="true">Coverage</th>
                                    <th data-tekton-column="actions" data-tekton-sortable="false">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body" data-tekton-table-body="true" data-tekton-loading-state="empty">
                                <!-- Results will be populated here -->
                                <tr class="synthesis__results-row" data-tekton-row="empty">
                                    <td colspan="7" class="synthesis__no-results" data-tekton-cell="empty">
                                        <div class="synthesis__empty-state">
                                            <div class="synthesis__empty-icon">ðŸ“Š</div>
                                            <h4 class="synthesis__empty-title">No Validation Results</h4>
                                            <p class="synthesis__empty-text">Run validation tests to see results here.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- @landmark Integration Panel -->
        <!-- Integration Panel -->
        <div id="integration-panel" class="synthesis__panel" data-tekton-panel="integration" data-tekton-panel-for="Integration" data-tekton-panel-component="synthesis" data-tekton-panel-active="false">
            <div class="synthesis__integration" data-tekton-functionality="external-systems">
                <h3 class="synthesis__section-title">External System Integration</h3>
                <p class="synthesis__text">Test connectivity and integration with external systems and APIs.</p>
                
                <div class="synthesis__integration-controls" data-tekton-form="integration-controls" data-tekton-form-type="configuration">
                    <div class="synthesis__control-group">
                        <label class="synthesis__control-label">System Type:</label>
                        <select id="integration-system-type" class="synthesis__select" data-tekton-select="system-type">
                            <option value="">Select system type...</option>
                            <option value="api">REST API</option>
                            <option value="database">Database</option>
                            <option value="message-queue">Message Queue</option>
                            <option value="file-system">File System</option>
                            <option value="service">External Service</option>
                        </select>
                    </div>
                    <div class="synthesis__control-group">
                        <label class="synthesis__control-label">Test Mode:</label>
                        <div class="synthesis__checkbox-group">
                            <input type="checkbox" id="connectivity-test" checked data-tekton-input="test-type">
                            <label for="connectivity-test" class="synthesis__checkbox-label">Connectivity Test</label>
                            <input type="checkbox" id="data-validation" data-tekton-input="test-type">
                            <label for="data-validation" class="synthesis__checkbox-label">Data Validation</label>
                            <input type="checkbox" id="performance-test" data-tekton-input="test-type">
                            <label for="performance-test" class="synthesis__checkbox-label">Performance Test</label>
                        </div>
                    </div>
                </div>
                
                <div class="synthesis__integration-results">
                    <div class="synthesis__systems-grid" data-tekton-list="system-cards" data-tekton-list-type="grid" data-tekton-monitor="true">
                        <div class="synthesis__system-card synthesis__system-card--healthy" data-tekton-card="system" data-tekton-card-id="hermes" data-tekton-status="healthy" data-tekton-testable="true">
                            <div class="synthesis__system-header" data-tekton-header="system">
                                <div class="synthesis__system-name" data-tekton-label="system-name">Hermes API</div>
                                <div class="synthesis__system-status synthesis__system-status--healthy" data-tekton-indicator="status" data-tekton-status-value="healthy">Healthy</div>
                            </div>
                            <div class="synthesis__system-details" data-tekton-metrics="system">
                                <span class="synthesis__system-detail" data-tekton-metric="response-time">Response: 45ms</span>
                                <span class="synthesis__system-detail" data-tekton-metric="last-check">Last Check: 2 min ago</span>
                            </div>
                            <div class="synthesis__system-actions">
                                <button class="synthesis__button synthesis__button--view" onclick="testSystemIntegration('hermes')" data-tekton-action="test-integration">Test</button>
                            </div>
                        </div>
                        
                        <div class="synthesis__system-card synthesis__system-card--warning" data-tekton-card="system" data-tekton-card-id="database" data-tekton-status="warning" data-tekton-testable="true">
                            <div class="synthesis__system-header" data-tekton-header="system">
                                <div class="synthesis__system-name" data-tekton-label="system-name">External Database</div>
                                <div class="synthesis__system-status synthesis__system-status--warning" data-tekton-indicator="status" data-tekton-status-value="warning">Warning</div>
                            </div>
                            <div class="synthesis__system-details" data-tekton-metrics="system">
                                <span class="synthesis__system-detail" data-tekton-metric="response-time">Response: 892ms</span>
                                <span class="synthesis__system-detail" data-tekton-metric="last-check">Last Check: 5 min ago</span>
                            </div>
                            <div class="synthesis__system-actions">
                                <button class="synthesis__button synthesis__button--view" onclick="testSystemIntegration('database')" data-tekton-action="test-integration">Test</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="synthesis__integration-actions">
                        <button id="test-all-integrations-btn" class="synthesis__button synthesis__button--validate" onclick="testAllIntegrations()" data-tekton-action="test-all-integrations">
                            <span class="synthesis__button-label">Test All Systems</span>
                        </button>
                        <button id="export-integration-report-btn" class="synthesis__button synthesis__button--export" onclick="exportIntegrationReport()" data-tekton-action="export-report">
                            <span class="synthesis__button-label">Export Report</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- @landmark Review Panel -->
        <!-- Review Panel -->
        <div id="review-panel" class="synthesis__panel" data-tekton-panel="review" data-tekton-panel-for="Review" data-tekton-panel-component="synthesis" data-tekton-panel-active="false">
            <div class="synthesis__review" data-tekton-functionality="planning-handoff">
                <h3 class="synthesis__section-title">Planning Team Handoff</h3>
                <p class="synthesis__text">Review validation results and hand off validated workflows to the Planning Review team.</p>
                
                <div class="synthesis__review-controls" data-tekton-form="review-controls" data-tekton-form-type="decision">
                    <div class="synthesis__control-group" data-tekton-field="sprint-review">
                        <label class="synthesis__control-label">Sprint to Review:</label>
                        <select id="review-sprint-select" class="synthesis__select" data-tekton-select="sprint">
                            <option value="">Select validated sprint...</option>
                        </select>
                    </div>
                    <div class="synthesis__control-group" data-tekton-field="review-status">
                        <label class="synthesis__control-label">Review Status:</label>
                        <div class="synthesis__radio-group">
                            <input type="radio" id="approve-sprint" name="review-status" value="approved" data-tekton-input="review-status">
                            <label for="approve-sprint" class="synthesis__radio-label">Approve for Implementation</label>
                            <input type="radio" id="reject-sprint" name="review-status" value="rejected" data-tekton-input="review-status">
                            <label for="reject-sprint" class="synthesis__radio-label">Reject (Needs Rework)</label>
                            <input type="radio" id="conditional-sprint" name="review-status" value="conditional" data-tekton-input="review-status">
                            <label for="conditional-sprint" class="synthesis__radio-label">Conditional Approval</label>
                        </div>
                    </div>
                </div>
                
                <div class="synthesis__review-summary" data-tekton-summary="validation" data-tekton-summary-type="review">
                    <div class="synthesis__summary-section" data-tekton-section="validation-summary">
                        <h4 class="synthesis__summary-title">Validation Summary</h4>
                        <div class="synthesis__summary-content" id="validation-summary" data-tekton-content="summary" data-tekton-content-type="dynamic">
                            <!-- Validation summary will be populated here -->
                            <div class="synthesis__empty-state">
                                <div class="synthesis__empty-icon">ðŸ“‹</div>
                                <p class="synthesis__empty-text">Select a sprint to view validation summary.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="synthesis__summary-section" data-tekton-section="validation-summary">
                        <h4 class="synthesis__summary-title">Requirements Coverage</h4>
                        <div class="synthesis__coverage-progress" data-tekton-progress="coverage" data-tekton-progress-type="percentage">
                            <div class="synthesis__progress-bar" data-tekton-progress-bar="true">
                                <div class="synthesis__progress-fill" style="width: 0%" data-tekton-progress-fill="true" data-tekton-progress-value="0"></div>
                            </div>
                            <div class="synthesis__progress-text" data-tekton-progress-label="true">0% Coverage</div>
                        </div>
                    </div>
                    
                    <div class="synthesis__summary-section" data-tekton-section="validation-summary">
                        <h4 class="synthesis__summary-title">Review Notes</h4>
                        <textarea id="review-notes" class="synthesis__textarea" placeholder="Add review notes and recommendations..." data-tekton-input="review-notes"></textarea>
                    </div>
                </div>
                
                <div class="synthesis__review-actions">
                    <button id="submit-review-btn" class="synthesis__button synthesis__button--export" onclick="submitReview()" data-tekton-action="submit-review">
                        <span class="synthesis__button-label">Submit to Planning Review</span>
                    </button>
                    <button id="save-draft-btn" class="synthesis__button synthesis__button--secondary" onclick="saveDraftReview()" data-tekton-action="save-draft">
                        <span class="synthesis__button-label">Save Draft</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- @landmark Workflow Chat Panel -->
        <!-- Workflow Chat Panel -->
        <div id="workflowchat-panel" class="synthesis__panel" data-tekton-chat="panel" style="position: relative; overflow: hidden;" data-tekton-panel="workflowchat" data-tekton-panel-for="Workflow Chat" data-tekton-panel-component="synthesis" data-tekton-panel-active="false">
            <div id="workflowchat-messages" class="synthesis__chat-messages" data-tekton-chat="messages" data-tekton-chat-type="workflow" data-tekton-scrollable="true">
                <!-- Welcome message -->
                <div class="synthesis__message synthesis__message--system" data-tekton-message="system" data-tekton-message-type="welcome">
                    <div class="synthesis__message-content" data-tekton-content="message">
                        <div class="synthesis__message-text" data-tekton-text="message">
                            <h3 class="synthesis__message-title">Synthesis Validation Assistant</h3>
                            <p>This chat provides assistance with workflow validation and testing. Ask questions about:</p>
                            <ul data-tekton-list="help-topics">
                                <li data-tekton-list-item="topic">Validation testing strategies and dry-run execution</li>
                                <li data-tekton-list-item="topic">Requirements coverage analysis and gap identification</li>
                                <li data-tekton-list-item="topic">Integration testing with external systems</li>
                                <li data-tekton-list-item="topic">Best practices for workflow validation and quality assurance</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- @landmark Team Chat Panel -->
        <!-- Team Chat Tab -->
        <div id="teamchat-panel" class="synthesis__panel" data-tekton-chat="panel" style="position: relative; overflow: hidden;" data-tekton-panel="teamchat" data-tekton-panel-for="Team Chat" data-tekton-panel-component="synthesis" data-tekton-panel-active="false">
            <div id="teamchat-messages" class="synthesis__chat-messages" data-tekton-chat="messages" data-tekton-chat-type="team" data-tekton-scrollable="true">
                <!-- Welcome message -->
                <div class="synthesis__message synthesis__message--system" data-tekton-message="system" data-tekton-message-type="welcome">
                    <div class="synthesis__message-content" data-tekton-content="message">
                        <div class="synthesis__message-text" data-tekton-text="message">
                            <h3 class="synthesis__message-title">Tekton Team Chat</h3>
                            <p>This chat is shared across all Tekton components. Use this for team communication and coordination.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- @landmark Footer Section -->
    <!-- Footer with Chat Input -->
    <div class="synthesis__footer" data-tekton-zone="footer">
        <div class="synthesis__chat-input-container" data-tekton-chat="input">
            <div class="synthesis__chat-prompt" data-tekton-chat="container">></div>
            <input type="text" id="synthesis-chat-input" class="synthesis__chat-input" data-tekton-chat="input" 
                   placeholder="Enter validation questions, testing commands, or chat messages"
                   onkeypress="if(event.key==='Enter'){synthesis_sendChat(); return false;}">
            <button id="synthesis-send-button" class="synthesis__send-button" onclick="synthesis_sendChat(); return false;" data-tekton-action="send-message" data-tekton-action-type="primary">Send</button>
        </div>
    </div>
</div>

<!-- Add component-specific styles -->
<style>
    /* Synthesis component styles using BEM naming convention */

    /* Container */
    .synthesis {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        background-color: var(--bg-primary, #1e1e2e);
        color: var(--text-primary, #f0f0f0);
        /* No absolute positioning - proper component containment */
    }

    /* Header */
    .synthesis__header {
        display: flex;
        align-items: center;
        padding: 10px 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 50px; /* Match header height from Athena */
    }

    .synthesis__title-container {
        display: flex;
        align-items: center;
    }

    .synthesis__icon {
        height: 30px;
        width: auto;
        margin-right: 12px;
    }

    .synthesis__title {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 500;
    }

    .synthesis__title-sub {
        margin-left: 8px;
        opacity: 0.8;
        font-weight: normal;
    }

    /* Menu Bar */
    .synthesis__menu-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Match menu bar height from Athena */
    }

    .synthesis__tabs {
        display: flex;
        gap: 8px;
    }

    .synthesis__tab {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background-color: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .synthesis__tab:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }

    .synthesis__tab--active {
        border-bottom-color: var(--color-primary, #2196F3); /* Synthesis blue color */
        font-weight: 500;
    }

    /* Content Area */
    .synthesis__content {
        flex: 1;
        overflow: hidden;
        position: relative;
    }

    .synthesis__panel {
        display: none;
        height: 100%;
        width: 100%;
        overflow: auto;
        padding: 0; /* Remove padding to match Athena's fit */
    }

    .synthesis__panel--active {
        display: block;
    }

    /* Control Bar */
    .synthesis__control-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        margin: 0; /* Remove margin to match Athena */
        padding: 16px; /* Match Athena's padding */
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        height: 46px; /* Match Athena's control bar height */
    }

    .synthesis__search-container {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
        min-width: 200px;
    }

    .synthesis__search-input {
        flex: 1;
        min-width: 200px;
        padding: 6px 12px;
        background-color: var(--bg-element, #2a2a3a);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
    }

    .synthesis__search-button {
        padding: 6px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
    }

    .synthesis__filter-container {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .synthesis__input-group {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .synthesis__input-label {
        font-size: 0.9rem;
        white-space: nowrap;
    }

    .synthesis__select {
        padding: 6px 10px;
        background-color: var(--bg-element, #2a2a3a);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
    }

    .synthesis__actions {
        display: flex;
        gap: 8px;
        margin-left: auto;
    }

    /* Execution List */
    .synthesis__executions-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 16px;
    }

    .synthesis__execution-item {
        padding: 12px;
        background-color: var(--bg-secondary, #252535);
        border-radius: 4px;
        border-left: 4px solid transparent;
    }

    .synthesis__execution-item--running {
        border-left-color: var(--status-running, #2196F3);
    }

    .synthesis__execution-item--completed {
        border-left-color: var(--status-success, #4CAF50);
    }

    .synthesis__execution-item--failed {
        border-left-color: var(--status-error, #F44336);
    }

    .synthesis__execution-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .synthesis__execution-title {
        font-weight: 500;
        font-size: 1rem;
    }

    .synthesis__execution-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.9rem;
    }

    .synthesis__execution-id {
        opacity: 0.7;
        font-family: monospace;
    }

    .synthesis__execution-status {
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.85rem;
    }

    .synthesis__execution-status--running {
        background-color: var(--status-running, #2196F3);
        color: white;
    }

    .synthesis__execution-status--completed {
        background-color: var(--status-success, #4CAF50);
        color: white;
    }

    .synthesis__execution-status--failed {
        background-color: var(--status-error, #F44336);
        color: white;
    }

    .synthesis__execution-progress {
        margin-bottom: 10px;
    }

    .synthesis__progress-bar {
        height: 8px;
        background-color: var(--bg-element, #2a2a3a);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 5px;
    }

    .synthesis__progress-fill {
        height: 100%;
        background-color: var(--color-primary, #2196F3);
        border-radius: 4px;
    }

    .synthesis__progress-text {
        font-size: 0.8rem;
        opacity: 0.8;
        text-align: right;
    }

    .synthesis__execution-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
    }

    /* Empty State */
    .synthesis__empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        text-align: center;
        background-color: var(--bg-secondary, #252535);
        border-radius: 4px;
        height: 300px;
    }

    .synthesis__empty-state-title {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1.1rem;
        font-weight: 500;
    }

    .synthesis__empty-state-text {
        margin: 0;
        opacity: 0.8;
    }

    /* Table Styles */
    .synthesis__table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    .synthesis__table th,
    .synthesis__table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid var(--border-color, #444444);
    }

    .synthesis__table th {
        font-weight: 500;
        background-color: var(--bg-tertiary, #333345);
    }

    .synthesis__workflow-row:hover,
    .synthesis__history-row:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }

    /* Status Indicators */
    .synthesis__status {
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.8rem;
        display: inline-block;
    }

    .synthesis__status--active { background-color: #2196F3; color: white; }
    .synthesis__status--inactive { background-color: #9E9E9E; color: white; }
    .synthesis__status--completed { background-color: #4CAF50; color: white; }
    .synthesis__status--failed { background-color: #F44336; color: white; }
    .synthesis__status--cancelled { background-color: #FFC107; color: black; }

    /* Dashboard Cards */
    .synthesis__metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }

    .synthesis__metric-card {
        padding: 16px;
        background-color: var(--bg-secondary, #252535);
        border-radius: 4px;
        text-align: center;
    }

    .synthesis__metric-value {
        font-size: 2rem;
        font-weight: 500;
        margin-bottom: 6px;
        color: var(--color-primary, #2196F3);
    }

    .synthesis__metric-label {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    /* Charts */
    .synthesis__charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
    }

    .synthesis__chart-wrapper {
        background-color: var(--bg-secondary, #252535);
        border-radius: 4px;
        padding: 16px;
    }

    .synthesis__chart-title {
        margin-top: 0;
        margin-bottom: 16px;
        font-size: 1rem;
        font-weight: 500;
    }

    .synthesis__chart {
        height: 200px;
        width: 100%;
        background-color: var(--bg-element, #2a2a3a);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Buttons */
    .synthesis__action-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
    }

    .synthesis__action-button:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }

    .synthesis__button {
        padding: 6px 12px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
    }

    .synthesis__button:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }

    .synthesis__button--small {
        padding: 3px 8px;
        font-size: 0.8rem;
    }

    .synthesis__button--primary {
        background-color: var(--color-primary, #2196F3);
        border-color: var(--color-primary, #2196F3);
        color: white;
    }

    .synthesis__table-action-btn {
        padding: 3px 8px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 3px;
        color: var(--text-primary, #f0f0f0);
        font-size: 0.8rem;
        cursor: pointer;
        margin-right: 4px;
    }

    .synthesis__table-action-btn:hover {
        background-color: var(--bg-hover, #3a3a4a);
    }

    /* Pagination */
    .synthesis__pagination {
        display: flex;
        justify-content: center;
        gap: 4px;
        padding: 16px;
    }

    .synthesis__pagination-btn {
        padding: 6px 10px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 3px;
        color: var(--text-primary, #f0f0f0);
        cursor: pointer;
    }

    .synthesis__pagination-btn--active {
        background-color: var(--color-primary, #2196F3);
        border-color: var(--color-primary, #2196F3);
        color: white;
    }

    .synthesis__pagination-btn--disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .synthesis__pagination-ellipsis {
        padding: 6px 4px;
        opacity: 0.7;
    }

    /* Loading Indicator */
    .synthesis__loading-indicator {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 0;
    }

    .synthesis__spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(33, 150, 243, 0.1);
        border-top-color: var(--color-primary, #2196F3);
        border-radius: 50%;
        animation: synthesis-spin 1s linear infinite;
    }

    @keyframes synthesis-spin {
        to { transform: rotate(360deg); }
    }

    .synthesis__loading-text {
        margin-top: 12px;
        font-size: 0.9rem;
        color: var(--text-secondary, #aaaaaa);
    }

    /* Chat Areas */
    .synthesis__chat-messages {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 70px; /* Height of the footer */
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .synthesis__message {
        max-width: 80%;
    }

    .synthesis__message--user {
        align-self: flex-end;
    }
    
    .synthesis__message--ai {
        align-self: flex-start;
    }

    .synthesis__message--system {
        align-self: center;
        max-width: 600px;
    }

    .synthesis__message-content {
        /* Content wrapper - styles are on the specific message types */
    }

    .synthesis__message--user .synthesis__message-content {
        background-color: #4CAF50;
        color: white;
        border-radius: 18px;
        border-bottom-right-radius: 4px;
        padding: 10px 16px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .synthesis__message--ai .synthesis__message-content {
        background-color: var(--bg-secondary, #252535);
        color: var(--text-primary, #f0f0f0);
        border-radius: 18px;
        border-bottom-left-radius: 4px;
        padding: 10px 16px;
        border: 1px solid var(--border-color, #444444);
    }

    .synthesis__message--system .synthesis__message-content {
        background-color: var(--bg-tertiary, #333345);
        border-left: 3px solid var(--color-primary, #2196F3);
        border-radius: 4px;
    }

    .synthesis__message-title {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1rem;
        font-weight: 500;
    }

    .synthesis__message-text {
        line-height: 1.4;
    }

    .synthesis__message-text ul {
        margin-top: 6px;
        margin-bottom: 6px;
        padding-left: 20px;
    }

    /* Footer */
    .synthesis__footer {
        padding: 12px 16px;
        background-color: var(--bg-secondary, #252535);
        border-top: 1px solid var(--border-color, #444444);
        height: 70px; /* Match footer height from Athena */
    }

    .synthesis__chat-input-container {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .synthesis__chat-prompt {
        font-family: monospace;
        font-size: 1.2rem;
        color: #2196F3; /* Match Synthesis's blue theme color */
    }

    .synthesis__chat-input {
        flex: 1;
        height: 44px;
        padding: 8px 16px;
        background-color: var(--bg-tertiary, #333345);
        border: 1px solid var(--border-color, #444444);
        border-radius: 8px;
        color: var(--text-primary, #f0f0f0);
        font-size: 14px;
    }

    .synthesis__chat-input:focus {
        outline: none;
        border-color: var(--color-primary, #7B1FA2); /* Match Athena's purple */
    }

    .synthesis__send-button {
        height: 44px;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #2196F3; /* Match Synthesis's blue theme color */
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .synthesis__send-button:hover {
        background-color: #1976D2; /* Darker blue for hover */
    }
    
    /* Sprint Cards (following Planning Team workflow pattern) */
    .synthesis__section-title {
        margin: 16px 0 8px 16px;
        font-size: 1.2rem;
        font-weight: 500;
    }
    
    .synthesis__text {
        margin: 0 0 16px 16px;
        opacity: 0.8;
        font-size: 0.9rem;
    }
    
    .synthesis__sprint-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 16px;
        padding: 16px;
    }
    
    .synthesis__sprint-card {
        background-color: var(--bg-secondary, #252535);
        border-radius: 8px;
        border-left: 4px solid var(--color-primary, #2196F3);
        padding: 16px;
        transition: all 0.2s ease;
    }
    
    .synthesis__sprint-card:hover {
        background-color: var(--bg-hover, #3a3a4a);
        transform: translateY(-2px);
    }
    
    .synthesis__card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }
    
    .synthesis__sprint-name {
        font-size: 1.1rem;
        font-weight: 500;
        flex: 1;
    }
    
    .synthesis__sprint-status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        margin-left: 12px;
    }
    
    .synthesis__sprint-status--ready {
        background-color: rgba(33, 150, 243, 0.2);
        color: #2196F3;
        border: 1px solid #2196F3;
    }
    
    .synthesis__card-body {
        margin-bottom: 16px;
    }
    
    .synthesis__sprint-description {
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 12px;
        opacity: 0.9;
    }
    
    .synthesis__sprint-meta {
        display: flex;
        gap: 16px;
        font-size: 0.85rem;
        opacity: 0.8;
    }
    
    .synthesis__meta-item {
        display: flex;
        gap: 4px;
    }
    
    .synthesis__meta-label {
        font-weight: 500;
    }
    
    .synthesis__card-actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
    }
    
    /* Button Color Scheme (Sprint Requirements) */
    .synthesis__button--view {
        background-color: #FFC107; /* Yellow for View */
        border-color: #FFC107;
        color: #000;
    }
    
    .synthesis__button--view:hover {
        background-color: #FFB300;
        border-color: #FFB300;
    }
    
    .synthesis__button--edit {
        background-color: #4CAF50; /* Green for Edit */
        border-color: #4CAF50;
        color: white;
    }
    
    .synthesis__button--edit:hover {
        background-color: #45a049;
        border-color: #45a049;
    }
    
    .synthesis__button--validate,
    .synthesis__button--export {
        background-color: #7B1FA2; /* Purple for Export/Validate */
        border-color: #7B1FA2;
        color: white;
    }
    
    .synthesis__button--validate:hover,
    .synthesis__button--export:hover {
        background-color: #6A1B9A;
        border-color: #6A1B9A;
    }
    
    /* Validation Controls */
    .synthesis__validation-controls,
    .synthesis__integration-controls,
    .synthesis__review-controls {
        background-color: var(--bg-secondary, #252535);
        padding: 16px;
        margin: 16px;
        border-radius: 8px;
        border: 1px solid var(--border-color, #444444);
    }
    
    .synthesis__control-group {
        margin-bottom: 16px;
    }
    
    .synthesis__control-group:last-child {
        margin-bottom: 0;
    }
    
    .synthesis__control-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    .synthesis__radio-group,
    .synthesis__checkbox-group {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
    }
    
    .synthesis__radio-label,
    .synthesis__checkbox-label {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
        cursor: pointer;
    }
    
    .synthesis__textarea {
        width: 100%;
        min-height: 100px;
        padding: 12px;
        background-color: var(--bg-element, #2a2a3a);
        border: 1px solid var(--border-color, #444444);
        border-radius: 4px;
        color: var(--text-primary, #f0f0f0);
        font-family: inherit;
        font-size: 0.9rem;
        line-height: 1.4;
        resize: vertical;
    }
    
    .synthesis__textarea:focus {
        outline: none;
        border-color: var(--color-primary, #2196F3);
    }
    
    /* System Cards */
    .synthesis__systems-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
        margin: 16px;
    }
    
    .synthesis__system-card {
        background-color: var(--bg-secondary, #252535);
        border-radius: 8px;
        padding: 16px;
        border-left: 4px solid transparent;
    }
    
    .synthesis__system-card--healthy {
        border-left-color: #4CAF50;
    }
    
    .synthesis__system-card--warning {
        border-left-color: #FF9800;
    }
    
    .synthesis__system-card--error {
        border-left-color: #F44336;
    }
    
    .synthesis__system-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .synthesis__system-name {
        font-weight: 500;
    }
    
    .synthesis__system-status {
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .synthesis__system-status--healthy {
        background-color: rgba(76, 175, 80, 0.2);
        color: #4CAF50;
    }
    
    .synthesis__system-status--warning {
        background-color: rgba(255, 152, 0, 0.2);
        color: #FF9800;
    }
    
    .synthesis__system-status--error {
        background-color: rgba(244, 67, 54, 0.2);
        color: #F44336;
    }
    
    .synthesis__system-details {
        display: flex;
        gap: 12px;
        font-size: 0.85rem;
        opacity: 0.8;
        margin-bottom: 12px;
    }
    
    .synthesis__system-actions {
        display: flex;
        justify-content: flex-end;
    }
    
    /* Action Groups */
    .synthesis__validation-actions,
    .synthesis__integration-actions,
    .synthesis__review-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        padding: 16px;
        background-color: var(--bg-tertiary, #333345);
        margin: 16px;
        border-radius: 8px;
    }
    
    /* Review Summary */
    .synthesis__review-summary {
        margin: 16px;
        display: grid;
        gap: 16px;
        grid-template-columns: 1fr;
    }
    
    .synthesis__summary-section {
        background-color: var(--bg-secondary, #252535);
        padding: 16px;
        border-radius: 8px;
        border: 1px solid var(--border-color, #444444);
    }
    
    .synthesis__summary-title {
        margin: 0 0 12px 0;
        font-size: 1rem;
        font-weight: 500;
    }
    
    .synthesis__coverage-progress {
        margin-top: 8px;
    }
    
    /* Results Filter */
    .synthesis__results-filter {
        display: flex;
        gap: 16px;
        padding: 16px;
        background-color: var(--bg-secondary, #252535);
        border-bottom: 1px solid var(--border-color, #444444);
        flex-wrap: wrap;
    }
    
    .synthesis__filter-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .synthesis__filter-label {
        font-size: 0.9rem;
        font-weight: 500;
        white-space: nowrap;
    }
    
    .synthesis__no-results {
        text-align: center;
        padding: 40px 20px;
    }
</style>

<script type="text/javascript">
// SIMPLIFIED COMPONENT SCRIPT - FULLY SELF-CONTAINED
// This version minimizes interference with other components

// IMMEDIATELY SET UP UI MANAGER PROTECTION
// Tell UI Manager to ignore this component - must be done IMMEDIATELY to avoid races
if (window.uiManager) {
    window.uiManager._ignoreComponent = 'synthesis';
    console.log('[SYNTHESIS] Set UI Manager to ignore synthesis component');
}

// DEFINE TAB SWITCHING FUNCTION
// CRITICAL: This uses no shared code/utilities to avoid conflicts
window.synthesis_switchTab = function(tabId) {
    console.log('[SYNTHESIS] Switching to tab:', tabId);
    
    // Force HTML panel visibility
    const htmlPanelElements = document.querySelectorAll('#html-panel');
    htmlPanelElements.forEach(panel => {
        if (panel) panel.style.display = 'block';
    });
    
    try {
        // Only select elements within synthesis component to avoid conflicts with other components
        const synthesisContainer = document.querySelector('.synthesis');
        if (!synthesisContainer) {
            console.error('[SYNTHESIS] Tab Switch: Cannot find synthesis container');
            return false;
        }
        
        // Update tab active state - ONLY WITHIN SYNTHESIS CONTAINER
        const tabs = synthesisContainer.querySelectorAll('.synthesis__tab');
        tabs.forEach(tab => {
            if (tab.getAttribute('data-tab') === tabId) {
                tab.classList.add('synthesis__tab--active');
            } else {
                tab.classList.remove('synthesis__tab--active');
            }
        });
        
        // Update panel visibility - ONLY WITHIN SYNTHESIS CONTAINER
        const panels = synthesisContainer.querySelectorAll('.synthesis__panel');
        panels.forEach(panel => {
            const panelId = panel.id;
            if (panelId === tabId + '-panel') {
                panel.style.display = 'block';
                panel.classList.add('synthesis__panel--active');
            } else {
                panel.style.display = 'none';
                panel.classList.remove('synthesis__panel--active');
            }
        });
        
        // Clear button removed, no need to update visibility
        
        // Update validate button visibility for validation tabs
        const validateButton = synthesisContainer.querySelector('#validate-sprint-btn');
        if (validateButton) {
            validateButton.style.display = (tabId === 'dashboard' || tabId === 'validation') ? 'block' : 'none';
        }
        
        // Update component state
        if (window.synthesisComponent) {
            window.synthesisComponent.state = window.synthesisComponent.state || {};
            window.synthesisComponent.state.activeTab = tabId;
            
            // Call component-specific methods if available
            if (typeof window.synthesisComponent.updateChatPlaceholder === 'function') {
                window.synthesisComponent.updateChatPlaceholder(tabId);
            }
            
            if (typeof window.synthesisComponent.loadTabContent === 'function') {
                window.synthesisComponent.loadTabContent(tabId);
            }
            
            // Special handling for dashboard to ensure sprints load
            if (tabId === 'dashboard' && window.synthesisComponent.renderSprintCards) {
                console.log('[SYNTHESIS] Dashboard tab activated, re-rendering sprint cards');
                setTimeout(() => {
                    window.synthesisComponent.renderSprintCards();
                }, 50);
            }
            
            if (typeof window.synthesisComponent.saveComponentState === 'function') {
                window.synthesisComponent.saveComponentState();
            }
        }
    } catch (err) {
        console.error('[SYNTHESIS] Error in tab switching:', err);
    }
    
    return false; // Stop event propagation
};

// Initialize chat components
function synthesis_initChats() {
    const workflowChatEl = document.getElementById('workflowchat-messages');
    const teamChatEl = document.getElementById('teamchat-messages');
    
    if (window.SingleChat && workflowChatEl) {
        window.SingleChat.init(workflowChatEl, 'synthesis', 'synthesis');
    }
    
    if (window.TeamChat && teamChatEl) {
        window.TeamChat.init(teamChatEl, 'synthesis', 'synthesis');
    }
}

// CHAT SENDING FUNCTION - delegate to unified chat components
window.synthesis_sendChat = function() {
    const input = document.getElementById('synthesis-chat-input');
    const message = input.value.trim();
    if (!message) return;
    
    const workflowChatTab = document.querySelector('[data-tab="workflowchat"]');
    const teamChatTab = document.querySelector('[data-tab="teamchat"]');
    const workflowChatActive = workflowChatTab && workflowChatTab.classList.contains('synthesis__tab--active');
    const teamChatActive = teamChatTab && teamChatTab.classList.contains('synthesis__tab--active');
    
    // If we're not on a chat tab, switch to workflow chat first
    if (!workflowChatActive && !teamChatActive) {
        if (workflowChatTab) {
            workflowChatTab.click();
            // Small delay to let the CSS transition complete
            setTimeout(() => {
                const workflowChatEl = document.getElementById('workflowchat-messages');
                if (window.SingleChat && workflowChatEl) {
                    window.SingleChat.sendMessage(workflowChatEl, message);
                }
                input.value = '';
            }, 100);
            return;
        }
    }
    
    // Normal chat behavior when already on a chat tab
    if (workflowChatActive) {
        const workflowChatEl = document.getElementById('workflowchat-messages');
        if (window.SingleChat && workflowChatEl) {
            window.SingleChat.sendMessage(workflowChatEl, message);
        }
    } else if (teamChatActive) {
        const teamChatEl = document.getElementById('teamchat-messages');
        if (window.TeamChat && teamChatEl) {
            window.TeamChat.sendMessage(teamChatEl, message);
        }
    }
    
    input.value = '';
};

// Keep the rest of the teamchat implementation for now
window.synthesis_sendChat_original = function() {
    console.log('[SYNTHESIS] Sending chat message');
    
    try {
        const synthesisContainer = document.querySelector('.synthesis');
        if (!synthesisContainer) {
            console.error('[SYNTHESIS] Send Chat: Cannot find synthesis container');
            return false;
        }
        
        const chatInput = synthesisContainer.querySelector('#synthesis-chat-input');
        if (!chatInput) {
            console.error('[SYNTHESIS] Send Chat: Cannot find chat input');
            return false;
        }
        
        const message = chatInput.value.trim();
        if (!message) {
            console.log('[SYNTHESIS] Send Chat: Empty message, ignoring');
            return false;
        }
        
        // Determine which chat to send to using Terma-style binary fallback
        const workflowChatTab = synthesisContainer.querySelector('[data-tab="workflowchat"]');
        const workflowChatActive = workflowChatTab && workflowChatTab.classList.contains('synthesis__tab--active');
        const chatType = workflowChatActive ? 'workflowchat' : 'teamchat';
        
        // Get the appropriate chat container
        const chatContainer = synthesisContainer.querySelector(chatType === 'workflowchat' ? '#workflowchat-messages' : '#teamchat-messages');
        
        if (!chatContainer) {
            console.error('[SYNTHESIS] Send Chat: Cannot find chat container for', chatType);
            return false;
        }
        
        // Create user message element
        const messageDiv = document.createElement('div');
        messageDiv.className = 'synthesis__message synthesis__message--user';
        messageDiv.setAttribute('data-tekton-message', 'user');
        messageDiv.setAttribute('data-tekton-message-type', 'text');
        messageDiv.innerHTML = `
            <div class="synthesis__message-content" data-tekton-content="message">
                <div class="synthesis__message-text" data-tekton-text="message">${message}</div>
            </div>
        `;
        
        chatContainer.appendChild(messageDiv);
        
        // Clear input
        chatInput.value = '';
        
        // Scroll to bottom
        chatContainer.scrollTop = chatContainer.scrollHeight;
        
        console.log('[SYNTHESIS] Message sent to', chatType || 'determined chat');
        
        // Send message to backend via window.AIChat
        if (window.AIChat) {
            // Determine which AIChat method to use based on chat type
            if (chatType === 'workflowchat') {
                // For execution chat, use sendMessage with component name
                if (typeof window.AIChat.sendMessage === 'function') {
                    window.AIChat.sendMessage('synthesis', message).then(response => {
                        console.log('[SYNTHESIS] AI response received:', response);
                        
                        // Create AI response message element
                        const responseDiv = document.createElement('div');
                        responseDiv.className = 'synthesis__message synthesis__message--ai';
                        responseDiv.setAttribute('data-tekton-message', 'ai');
                        responseDiv.setAttribute('data-tekton-message-from', 'synthesis');
                        responseDiv.setAttribute('data-tekton-message-type', 'response');
                        responseDiv.innerHTML = `
                            <div class="synthesis__message-content" data-tekton-content="message">
                                <div class="synthesis__message-text" data-tekton-text="message">Synthesis: ${response.content}</div>
                            </div>
                        `;
                        
                        chatContainer.appendChild(responseDiv);
                        
                        // Scroll to bottom
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                        
                    }).catch(error => {
                        console.error('[SYNTHESIS] Error sending message to AI:', error);
                        
                        // Show error message in chat
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'synthesis__message synthesis__message--system';
                        errorDiv.setAttribute('data-tekton-message', 'system');
                        errorDiv.setAttribute('data-tekton-message-type', 'error');
                        errorDiv.innerHTML = `
                            <div class="synthesis__message-content" data-tekton-content="message">
                                <div class="synthesis__message-text" data-tekton-text="message">Error: Unable to send message. Please try again.</div>
                            </div>
                        `;
                        
                        chatContainer.appendChild(errorDiv);
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    });
                }
            } else if (chatType === 'teamchat') {
                // For team chat, use teamChat method
                if (typeof window.AIChat.teamChat === 'function') {
                    window.AIChat.teamChat(message, 'synthesis').then(data => {
                        console.log('[SYNTHESIS] Team chat response received:', data);
                        
                        // Handle multiple responses from team chat
                        if (data.responses && data.responses.length > 0) {
                            data.responses.forEach(resp => {
                                // Extract sender name from socket_id (e.g., "apollo-ai" -> "Apollo")
                                const sender = resp.socket_id.replace('-ai', '').charAt(0).toUpperCase() + 
                                             resp.socket_id.replace('-ai', '').slice(1);
                                
                                // Create AI response message element
                                const responseDiv = document.createElement('div');
                                responseDiv.className = 'synthesis__message synthesis__message--ai';
                                responseDiv.innerHTML = `
                                    <div class="synthesis__message-content" data-tekton-content="message">
                                        <div class="synthesis__message-text" data-tekton-text="message"><strong>${sender}:</strong> ${resp.content}</div>
                                    </div>
                                `;
                                
                                chatContainer.appendChild(responseDiv);
                            });
                            
                            // Scroll to bottom after all messages added
                            chatContainer.scrollTop = chatContainer.scrollHeight;
                        }
                        
                    }).catch(error => {
                        console.error('[SYNTHESIS] Error sending team message:', error);
                        
                        // Show error message in chat
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'synthesis__message synthesis__message--system';
                        errorDiv.setAttribute('data-tekton-message', 'system');
                        errorDiv.setAttribute('data-tekton-message-type', 'error');
                        errorDiv.innerHTML = `
                            <div class="synthesis__message-content" data-tekton-content="message">
                                <div class="synthesis__message-text" data-tekton-text="message">Error: Unable to send team message. Please try again.</div>
                            </div>
                        `;
                        
                        chatContainer.appendChild(errorDiv);
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    });
                }
            }
        } else {
            console.warn('[SYNTHESIS] window.AIChat not available');
            
            // Fallback to component handler if available
            if (window.synthesisComponent && typeof window.synthesisComponent.handleChatMessage === 'function') {
                window.synthesisComponent.handleChatMessage(message, chatType);
            }
        }
    } catch (err) {
        console.error('[SYNTHESIS] Error in sending chat:', err);
    }
    
    return false; // Stop event propagation
};

// CHAT CLEARING FUNCTION
window.synthesis_clearChat = function() {
    console.log('[SYNTHESIS] Clearing chat messages');
    
    try {
        const synthesisContainer = document.querySelector('.synthesis');
        if (!synthesisContainer) {
            console.error('[SYNTHESIS] Clear Chat: Cannot find synthesis container');
            return false;
        }
        
        // Determine which chat to clear based on active tab
        const activeTab = synthesisContainer.querySelector('.synthesis__tab--active');
        if (!activeTab) {
            console.error('[SYNTHESIS] Clear Chat: Cannot determine active tab');
            return false;
        }
        
        const chatType = activeTab.getAttribute('data-tab');
        let chatContainer;
        
        if (chatType === 'workflowchat') {
            chatContainer = synthesisContainer.querySelector('#workflowchat-messages');
        } else if (chatType === 'teamchat') {
            chatContainer = synthesisContainer.querySelector('#teamchat-messages');
        }
        
        if (!chatContainer) {
            console.error('[SYNTHESIS] Clear Chat: Cannot find chat container for', chatType);
            return false;
        }
        
        // Keep only the system welcome message
        const welcomeMessage = chatContainer.querySelector('.synthesis__message--system');
        if (welcomeMessage) {
            chatContainer.innerHTML = '';
            chatContainer.appendChild(welcomeMessage);
        } else {
            chatContainer.innerHTML = '';
        }
        
        console.log('[SYNTHESIS] Chat messages cleared for', chatType);
    } catch (err) {
        console.error('[SYNTHESIS] Error in clearing chat:', err);
    }
    
    return false; // Stop event propagation
};

// INITIALIZE COMPONENT
// Initialize the component after the minimal loader loads scripts
function synthesis_initializeComponent() {
    console.log('[SYNTHESIS] Initializing component...');
    
    if (window.synthesisComponent && typeof window.synthesisComponent.init === 'function') {
        try {
            window.synthesisComponent.init();
            console.log('[SYNTHESIS] Component initialized');
        } catch (err) {
            console.error('[SYNTHESIS] Component initialization error:', err);
        }
    } else {
        console.warn('[SYNTHESIS] Component init function not found - will retry in 500ms');
        // The minimal loader should handle loading the scripts
        // but if it fails, we'll keep trying
        setTimeout(synthesis_initializeComponent, 500);
    }
}

// TEMPORARY: Direct load as fallback
// This is a temporary workaround until we fix the minimal loader issue
function synthesis_directLoadFallback() {
    console.log('[SYNTHESIS] Checking for component:', !!window.synthesisComponent, typeof window.synthesisComponent?.init);
    
    if (!window.synthesisComponent || typeof window.synthesisComponent.init !== 'function') {
        console.log('[SYNTHESIS] Attempting direct script load as fallback...');
        const script = document.createElement('script');
        script.src = '/scripts/synthesis/synthesis-component.js?t=' + Date.now();
        script.onload = function() {
            console.log('[SYNTHESIS] Direct load successful');
            console.log('[SYNTHESIS] After load - component exists:', !!window.synthesisComponent);
            console.log('[SYNTHESIS] After load - init exists:', typeof window.synthesisComponent?.init);
            synthesis_initializeComponent();
        };
        script.onerror = function(error) {
            console.error('[SYNTHESIS] Direct load failed:', error);
        };
        document.head.appendChild(script);
    } else {
        console.log('[SYNTHESIS] Component already loaded, initializing...');
        synthesis_initializeComponent();
    }
}

// Try direct load after a delay if minimal loader fails
setTimeout(synthesis_directLoadFallback, 2000);

// INLINE COMPONENT DEFINITION (TEMPORARY)
// This ensures the component works immediately while we debug the external loading
window.synthesisComponent = {
    state: {
        activeTab: 'dashboard',
        sprints: [],
        currentSprint: null,
        validationInProgress: false
    },

    init: function() {
        console.log('[SYNTHESIS INLINE] Component initializing...');
        
        // Wait a moment for DOM to be ready
        setTimeout(() => {
            this.loadSprintsFromDailyLogs();
            this.setupEventListeners();
            console.log('[SYNTHESIS INLINE] Component initialized');
        }, 100);
    },

    loadSprintsFromDailyLogs: function() {
        console.log('[SYNTHESIS INLINE] Loading Ready-3:Synthesis sprints...');
        
        const testSprints = [
            {
                id: 'test-synthesis-validation',
                name: 'Test Synthesis Validation',
                status: 'Ready-3:Synthesis',
                tasks: 8,
                hours: 32,
                description: 'Test sprint created to validate the Synthesis UI implementation.',
                components: ['Hermes', 'Engram', 'Athena', 'Synthesis'],
                path: 'Test_Synthesis_Validation_Sprint'
            },
            {
                id: 'ai-memory-enhancement',
                name: 'AI Memory Enhancement',
                status: 'Ready-3:Synthesis',
                tasks: 12,
                hours: 48,
                description: 'Enhance the Engram memory system with advanced semantic search capabilities.',
                components: ['Engram', 'Hermes', 'Sophia', 'Athena'],
                path: 'AI_Memory_Enhancement_Sprint'
            }
        ];

        this.state.sprints = testSprints;
        this.renderSprintCards();
    },

    renderSprintCards: function() {
        console.log('[SYNTHESIS INLINE] renderSprintCards called with', this.state.sprints.length, 'sprints');
        
        const sprintGrid = document.getElementById('sprint-grid');
        const noSprintsDiv = document.getElementById('no-sprints');
        
        if (!sprintGrid) {
            console.error('[SYNTHESIS INLINE] Sprint grid not found');
            return;
        }

        if (this.state.sprints.length === 0) {
            if (noSprintsDiv) {
                noSprintsDiv.style.display = 'block';
            }
            sprintGrid.innerHTML = '';
            return;
        }

        if (noSprintsDiv) {
            noSprintsDiv.style.display = 'none';
        }

        sprintGrid.innerHTML = '';

        this.state.sprints.forEach(sprint => {
            const card = this.createSprintCard(sprint);
            sprintGrid.appendChild(card);
        });

        console.log(`[SYNTHESIS INLINE] Rendered ${this.state.sprints.length} sprint cards`);
    },

    createSprintCard: function(sprint) {
        const card = document.createElement('div');
        card.className = 'synthesis__sprint-card';
        card.setAttribute('data-sprint-id', sprint.id);
        
        card.innerHTML = `
            <div class="synthesis__card-header" data-tekton-header="sprint-card">
                <span class="synthesis__sprint-name" data-tekton-text="sprint-name">${sprint.name}</span>
                <span class="synthesis__sprint-status synthesis__sprint-status--ready" data-tekton-status="sprint" data-tekton-status-value="ready">${sprint.status}</span>
            </div>
            <div class="synthesis__card-body" data-tekton-body="sprint-card">
                <p class="synthesis__sprint-description" data-tekton-text="sprint-description">${sprint.description}</p>
                <div class="synthesis__sprint-meta" data-tekton-meta="sprint-stats">
                    <span class="synthesis__meta-item" data-tekton-meta-item="tasks">
                        <span class="synthesis__meta-label" data-tekton-label="tasks">Tasks:</span>
                        <span class="synthesis__meta-value" data-tekton-value="task-count">${sprint.tasks}</span>
                    </span>
                    <span class="synthesis__meta-item" data-tekton-meta-item="hours">
                        <span class="synthesis__meta-label" data-tekton-label="hours">Total Hours:</span>
                        <span class="synthesis__meta-value" data-tekton-value="hour-count">${sprint.hours}</span>
                    </span>
                </div>
                <div class="synthesis__sprint-meta" data-tekton-meta="sprint-components">
                    <span class="synthesis__meta-item" data-tekton-meta-item="components">
                        <span class="synthesis__meta-label" data-tekton-label="components">Components:</span>
                        <span class="synthesis__meta-value" data-tekton-value="component-list">${sprint.components.join(', ')}</span>
                    </span>
                </div>
            </div>
            <div class="synthesis__card-actions" data-tekton-actions="sprint-card">
                <button class="synthesis__button synthesis__button--view"
                        onclick="synthesisComponent.viewSprint('${sprint.id}')"
                        data-tekton-action="view-sprint" data-tekton-trigger="click">View</button>
                <button class="synthesis__button synthesis__button--validate"
                        onclick="synthesisComponent.beginValidation('${sprint.id}')"
                        data-tekton-action="validate-sprint" data-tekton-trigger="click">Validate</button>
                <button class="synthesis__button synthesis__button--secondary"
                        onclick="synthesisComponent.skipToReview('${sprint.id}')"
                        data-tekton-action="skip-to-review" data-tekton-trigger="click">Skip to Review</button>
            </div>
        `;
        
        return card;
    },

    viewSprint: function(sprintId) {
        console.log('[SYNTHESIS INLINE] View sprint:', sprintId);
        const sprint = this.state.sprints.find(s => s.id === sprintId);
        if (sprint) {
            this.state.currentSprint = sprint;
            synthesis_switchTab('validation');
        }
    },

    beginValidation: function(sprintId) {
        console.log('[SYNTHESIS INLINE] Begin validation for sprint:', sprintId);
        const sprint = this.state.sprints.find(s => s.id === sprintId);
        if (sprint) {
            this.state.currentSprint = sprint;
            synthesis_switchTab('validation');
        }
    },

    skipToReview: function(sprintId) {
        console.log('[SYNTHESIS INLINE] Skip to review for sprint:', sprintId);
        const sprint = this.state.sprints.find(s => s.id === sprintId);
        if (sprint) {
            this.state.currentSprint = sprint;
            synthesis_switchTab('review');
        }
    },

    setupEventListeners: function() {
        // Basic event listeners
    }
};

// HTML PANEL PROTECTION
// Setup explicit protection for the HTML panel to prevent it being hidden
function synthesis_protectHtmlPanel() {
    const htmlPanel = document.getElementById('html-panel');
    if (!htmlPanel) {
        console.error('[SYNTHESIS] Cannot find HTML panel to protect');
        return;
    }
    
    console.log('[SYNTHESIS] Protecting HTML panel from being hidden');
    htmlPanel.style.display = 'block'; // Force it to be visible
    
    // Store the original display value
    if (!htmlPanel.hasOwnProperty('_synthesisOriginalDisplay')) {
        Object.defineProperty(htmlPanel, '_synthesisOriginalDisplay', {
            value: 'block',
            writable: true,
            configurable: true
        });
    }
    
    // Only define the getter/setter if it hasn't already been defined by this component
    if (!htmlPanel.style._synthesisProtected) {
        // Mark the display property as protected by this component
        Object.defineProperty(htmlPanel.style, '_synthesisProtected', {
            value: true,
            writable: false,
            configurable: true
        });
        
        // Protect the display property
        Object.defineProperty(htmlPanel.style, 'display', {
            get: function() { 
                return htmlPanel._synthesisOriginalDisplay; 
            },
            set: function(value) {
                console.log(`[SYNTHESIS] Intercepted attempt to set HTML panel display to: ${value}`);
                if (value === 'none') {
                    console.log('[SYNTHESIS] Blocked attempt to hide HTML panel');
                    htmlPanel._synthesisOriginalDisplay = 'block';
                } else {
                    htmlPanel._synthesisOriginalDisplay = value;
                }
            },
            configurable: true
        });
    }
}

// SETUP DONE AFTER PAGE LOAD
// This ensures the functions are available before the tab events need them
window.addEventListener('DOMContentLoaded', function() {
    console.log('[SYNTHESIS] DOM loaded, setting up Synthesis component');
    synthesis_protectHtmlPanel();
    synthesis_initializeComponent();
});

// IMMEDIATE PROTECTION
// In case the DOM is already loaded
if (document.readyState === 'complete' || document.readyState === 'interactive') {
    console.log('[SYNTHESIS] Document already loaded, setting up Synthesis component immediately');
    synthesis_protectHtmlPanel();
    synthesis_initializeComponent();
}

// SYNTHESIS VALIDATION FUNCTIONS
// Global functions for the Planning Team workflow validation interface

window.validateCurrentSprint = function() {
    console.log('[SYNTHESIS] Validate current sprint clicked');
    // TODO: Implement sprint validation logic
    return false;
};

window.startValidation = function() {
    console.log('[SYNTHESIS] Start validation clicked');
    // TODO: Implement validation start logic
    return false;
};

window.stopValidation = function() {
    console.log('[SYNTHESIS] Stop validation clicked');
    // TODO: Implement validation stop logic
    return false;
};

window.rollbackValidation = function() {
    console.log('[SYNTHESIS] Rollback validation clicked');
    // TODO: Implement validation rollback logic
    return false;
};

window.testSystemIntegration = function(systemName) {
    console.log('[SYNTHESIS] Test system integration:', systemName);
    // TODO: Implement system integration testing
    return false;
};

window.testAllIntegrations = function() {
    console.log('[SYNTHESIS] Test all integrations clicked');
    // TODO: Implement comprehensive integration testing
    return false;
};

window.exportIntegrationReport = function() {
    console.log('[SYNTHESIS] Export integration report clicked');
    // TODO: Implement integration report export
    return false;
};

window.submitReview = function() {
    console.log('[SYNTHESIS] Submit review clicked');
    // TODO: Implement review submission to Planning Team
    return false;
};

window.saveDraftReview = function() {
    console.log('[SYNTHESIS] Save draft review clicked');
    // TODO: Implement draft review saving
    return false;
};

// Initialize chat when component loads
setTimeout(() => {
    synthesis_initChats();
}, 100);
</script>